"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[232],{3905:(n,t,e)=>{e.d(t,{Zo:()=>u,kt:()=>s});var c=e(7294);function i(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function l(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);t&&(c=c.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,c)}return e}function h(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?l(Object(e),!0).forEach((function(t){i(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):l(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function r(n,t){if(null==n)return{};var e,c,i=function(n,t){if(null==n)return{};var e,c,i={},l=Object.keys(n);for(c=0;c<l.length;c++)e=l[c],t.indexOf(e)>=0||(i[e]=n[e]);return i}(n,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);for(c=0;c<l.length;c++)e=l[c],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(n,e)&&(i[e]=n[e])}return i}var a=c.createContext({}),o=function(n){var t=c.useContext(a),e=t;return n&&(e="function"==typeof n?n(t):h(h({},t),n)),e},u=function(n){var t=o(n.components);return c.createElement(a.Provider,{value:t},n.children)},g="mdxType",p={inlineCode:"code",wrapper:function(n){var t=n.children;return c.createElement(c.Fragment,{},t)}},m=c.forwardRef((function(n,t){var e=n.components,i=n.mdxType,l=n.originalType,a=n.parentName,u=r(n,["components","mdxType","originalType","parentName"]),g=o(e),m=i,s=g["".concat(a,".").concat(m)]||g[m]||p[m]||l;return e?c.createElement(s,h(h({ref:t},u),{},{components:e})):c.createElement(s,h({ref:t},u))}));function s(n,t){var e=arguments,i=t&&t.mdxType;if("string"==typeof n||i){var l=e.length,h=new Array(l);h[0]=m;var r={};for(var a in t)hasOwnProperty.call(t,a)&&(r[a]=t[a]);r.originalType=n,r[g]="string"==typeof n?n:i,h[1]=r;for(var o=2;o<l;o++)h[o]=e[o];return c.createElement.apply(null,h)}return c.createElement.apply(null,e)}m.displayName="MDXCreateElement"},6846:(n,t,e)=>{e.r(t),e.d(t,{assets:()=>a,contentTitle:()=>h,default:()=>p,frontMatter:()=>l,metadata:()=>r,toc:()=>o});var c=e(7462),i=(e(7294),e(3905));const l={title:"Golang"},h=void 0,r={unversionedId:"blog/programming/golang",id:"blog/programming/golang",title:"Golang",description:"Concurrency trong Go: Goroutines, Channels v\xe0 Select",source:"@site/docs/blog/programming/golang.md",sourceDirName:"blog/programming",slug:"/blog/programming/golang",permalink:"/blog/programming/golang",draft:!1,tags:[],version:"current",frontMatter:{title:"Golang"},sidebar:"blog",previous:{title:"Node.js",permalink:"/blog/programming/nodejs"},next:{title:"Message Queue",permalink:"/blog/programming/message-queue"}},a={},o=[{value:"Concurrency trong Go: Goroutines, Channels v\xe0 Select",id:"concurrency-trong-go-goroutines-channels-v\xe0-select",level:2},{value:"Goroutines",id:"goroutines",level:3},{value:"Channels",id:"channels",level:3},{value:"Select Statement",id:"select-statement",level:3},{value:"C\xe1c C\u01a1 Ch\u1ebf \u0110\u1ed3ng B\u1ed9 H\xf3a Kh\xe1c (sync package)",id:"c\xe1c-c\u01a1-ch\u1ebf-\u0111\u1ed3ng-b\u1ed9-h\xf3a-kh\xe1c-sync-package",level:3},{value:"Concurrency vs. Parallelism trong Go",id:"concurrency-vs-parallelism-trong-go",level:2},{value:"So s\xe1nh \u0110\u01a1n lu\u1ed3ng vs. \u0110a lu\u1ed3ng (Goroutines):",id:"so-s\xe1nh-\u0111\u01a1n-lu\u1ed3ng-vs-\u0111a-lu\u1ed3ng-goroutines",level:4},{value:"Go Runtime: Scheduler, GC v\xe0 Lightweight Threads",id:"go-runtime-scheduler-gc-v\xe0-lightweight-threads",level:2},{value:"Scheduler (GMP Model)",id:"scheduler-gmp-model",level:3},{value:"Garbage Collector (GC)",id:"garbage-collector-gc",level:3},{value:"Lightweight Threads",id:"lightweight-threads",level:3},{value:"Qu\u1ea3n L\xfd B\u1ed9 Nh\u1edb: Stack, Heap, Escape Analysis v\xe0 Profiling",id:"qu\u1ea3n-l\xfd-b\u1ed9-nh\u1edb-stack-heap-escape-analysis-v\xe0-profiling",level:2},{value:"Stack vs. Heap Allocation",id:"stack-vs-heap-allocation",level:3},{value:"Escape Analysis (Ph\xe2n t\xedch Tho\xe1t)",id:"escape-analysis-ph\xe2n-t\xedch-tho\xe1t",level:3},{value:"Profiling v\u1edbi pprof",id:"profiling-v\u1edbi-pprof",level:3},{value:"C\xe1c M\u1eabu Concurrency Ph\u1ed5 Bi\u1ebfn",id:"c\xe1c-m\u1eabu-concurrency-ph\u1ed5-bi\u1ebfn",level:2},{value:"Worker Pools",id:"worker-pools",level:4},{value:"Fan-out / Fan-in",id:"fan-out--fan-in",level:4},{value:"Nh\u1eefng Kh\xe1i Ni\u1ec7m Golang Chuy\xean S\xe2u \xcdt Ng\u01b0\u1eddi Bi\u1ebft",id:"nh\u1eefng-kh\xe1i-ni\u1ec7m-golang-chuy\xean-s\xe2u-\xedt-ng\u01b0\u1eddi-bi\u1ebft",level:2}],u={toc:o},g="wrapper";function p(n){let{components:t,...e}=n;return(0,i.kt)(g,(0,c.Z)({},u,e,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"concurrency-trong-go-goroutines-channels-v\xe0-select"},"Concurrency trong Go: Goroutines, Channels v\xe0 Select"),(0,i.kt)("p",null,"Go coi concurrency l\xe0 c\xf4ng d\xe2n h\u1ea1ng nh\u1ea5t (first-class citizen). Thay v\xec s\u1eed d\u1ee5ng OS threads tr\u1ef1c ti\u1ebfp, Go cung c\u1ea5p c\xe1c c\u01a1 ch\u1ebf tr\u1eebu t\u01b0\u1ee3ng \u1edf m\u1ee9c cao h\u01a1n."),(0,i.kt)("h3",{id:"goroutines"},"Goroutines"),(0,i.kt)("p",null,"Goroutine l\xe0 m\u1ed9t h\xe0m ho\u1eb7c ph\u01b0\u01a1ng th\u1ee9c c\xf3 th\u1ec3 ch\u1ea1y \u0111\u1ed3ng th\u1eddi (concurrently) v\u1edbi c\xe1c h\xe0m/ph\u01b0\u01a1ng th\u1ee9c kh\xe1c. Ch\xfang c\u1ef1c k\u1ef3 nh\u1eb9 (lightweight) so v\u1edbi OS threads."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u0110\u1eb7c \u0111i\u1ec3m"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Stack c\xf3 th\u1ec3 m\u1edf r\u1ed9ng: Goroutine b\u1eaft \u0111\u1ea7u v\u1edbi m\u1ed9t stack nh\u1ecf (v\xe0i KB) v\xe0 c\xf3 th\u1ec3 t\u1ef1 \u0111\u1ed9ng t\u0103ng/gi\u1ea3m k\xedch th\u01b0\u1edbc khi c\u1ea7n, tr\xe1nh l\xe3ng ph\xed b\u1ed9 nh\u1edb.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Qu\u1ea3n l\xfd b\u1edfi Go Runtime: Vi\u1ec7c l\xean l\u1ecbch (scheduling) v\xe0 qu\u1ea3n l\xfd goroutines \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n b\u1edfi Go runtime scheduler, kh\xf4ng ph\u1ea3i OS scheduler.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Chi ph\xed th\u1ea5p: Vi\u1ec7c t\u1ea1o v\xe0 chuy\u1ec3n \u0111\u1ed5i ng\u1eef c\u1ea3nh (context switching) gi\u1eefa c\xe1c goroutine nhanh h\u01a1n nhi\u1ec1u so v\u1edbi OS threads. B\u1ea1n c\xf3 th\u1ec3 ch\u1ea1y h\xe0ng tr\u0103m ngh\xecn, th\u1eadm ch\xed h\xe0ng tri\u1ec7u goroutine trong m\u1ed9t \u1ee9ng d\u1ee5ng Go."))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u1ea2nh h\u01b0\u1edfng h\u1ec7 th\u1ed1ng"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"CPU: Nhi\u1ec1u goroutine c\xf3 th\u1ec3 ch\u1ea1y song song tr\xean nhi\u1ec1u l\xf5i CPU (parallelism) n\u1ebfu GOMAXPROCS > 1. Tr\xean m\u1ed9t l\xf5i, ch\xfang ch\u1ea1y \u0111\u1ed3ng th\u1eddi (concurrency) b\u1eb1ng c\xe1ch xen k\u1ebd.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"RAM: Chi ph\xed b\u1ed9 nh\u1edb ban \u0111\u1ea7u cho m\u1ed7i goroutine r\u1ea5t nh\u1ecf, gi\xfap ti\u1ebft ki\u1ec7m RAM \u0111\xe1ng k\u1ec3 so v\u1edbi m\xf4 h\xecnh thread-per-request.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Process: T\u1ea5t c\u1ea3 goroutines ch\u1ea1y trong c\xf9ng m\u1ed9t process OS, chia s\u1ebb kh\xf4ng gian \u0111\u1ecba ch\u1ec9."))),(0,i.kt)("h3",{id:"channels"},"Channels"),(0,i.kt)("p",null,'Channels l\xe0 c\xe1c "\u1ed1ng d\u1eabn" c\xf3 ki\u1ec3u d\u1eef li\u1ec7u (typed conduits) cho ph\xe9p c\xe1c goroutine giao ti\u1ebfp v\xe0 \u0111\u1ed3ng b\u1ed9 h\xf3a (synchronize) v\u1edbi nhau b\u1eb1ng c\xe1ch g\u1eedi v\xe0 nh\u1eadn gi\xe1 tr\u1ecb. Tri\u1ebft l\xfd c\u1ee7a Go l\xe0: "Do not communicate by sharing memory; instead, share memory by communicating."'),(0,i.kt)("p",null,"C\xe1ch t\u1ea1o:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"myChannel := make(chan int) // (unbuffered)\nmyBufferedChannel := make(chan string, 10) // (buffered)\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Ho\u1ea1t \u0111\u1ed9ng"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"G\u1eedi: myChannel <- value")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Nh\u1eadn: value := <-myChannel")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Blocking:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"G\u1eedi tr\xean unbuffered channel s\u1ebd block goroutine g\u1eedi cho \u0111\u1ebfn khi c\xf3 goroutine kh\xe1c s\u1eb5n s\xe0ng nh\u1eadn.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Nh\u1eadn tr\xean unbuffered channel s\u1ebd block goroutine nh\u1eadn cho \u0111\u1ebfn khi c\xf3 goroutine kh\xe1c g\u1eedi gi\xe1 tr\u1ecb.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"G\u1eedi tr\xean buffered channel ch\u1ec9 block n\u1ebfu buffer \u0111\u1ea7y.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Nh\u1eadn tr\xean buffered channel ch\u1ec9 block n\u1ebfu buffer r\u1ed7ng.")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u0110\xf3ng channel: ",(0,i.kt)("inlineCode",{parentName:"p"},"close(myChannel)"),". Vi\u1ec7c nh\u1eadn t\u1eeb channel \u0111\xe3 \u0111\xf3ng s\u1ebd tr\u1ea3 v\u1ec1 gi\xe1 tr\u1ecb zero c\u1ee7a ki\u1ec3u d\u1eef li\u1ec7u v\xe0 m\u1ed9t gi\xe1 tr\u1ecb boolean false. G\u1eedi v\xe0o channel \u0111\xe3 \u0111\xf3ng s\u1ebd g\xe2y panic. L\u1eb7p qua channel b\u1eb1ng for range s\u1ebd t\u1ef1 \u0111\u1ed9ng d\u1eebng khi channel \u0111\u01b0\u1ee3c \u0111\xf3ng."))),(0,i.kt)("p",null,"\u1ea2nh h\u01b0\u1edfng h\u1ec7 th\u1ed1ng: Cung c\u1ea5p c\u01a1 ch\u1ebf \u0111\u1ed3ng b\u1ed9 h\xf3a an to\xe0n, tr\xe1nh \u0111\u01b0\u1ee3c nhi\u1ec1u v\u1ea5n \u0111\u1ec1 data race th\u01b0\u1eddng g\u1eb7p khi d\xf9ng b\u1ed9 nh\u1edb chia s\u1ebb v\xe0 locks truy\u1ec1n th\u1ed1ng."),(0,i.kt)("h3",{id:"select-statement"},"Select Statement"),(0,i.kt)("p",null,"Cho ph\xe9p m\u1ed9t goroutine \u0111\u1ee3i tr\xean nhi\u1ec1u channel operations (g\u1eedi ho\u1eb7c nh\u1eadn) c\xf9ng m\u1ed9t l\xfac."),(0,i.kt)("p",null,"C\xe1ch ho\u1ea1t \u0111\u1ed9ng:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"select s\u1ebd block cho \u0111\u1ebfn khi m\u1ed9t trong c\xe1c case (c\xe1c channel operation) s\u1eb5n s\xe0ng th\u1ef1c thi.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"N\u1ebfu nhi\u1ec1u case c\xf9ng s\u1eb5n s\xe0ng, select s\u1ebd ch\u1ecdn ng\u1eabu nhi\xean m\u1ed9t case \u0111\u1ec3 th\u1ef1c thi.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Case default: N\u1ebfu c\xf3 default, select s\u1ebd kh\xf4ng block. N\u1ebfu kh\xf4ng c\xf3 case n\xe0o kh\xe1c s\u1eb5n s\xe0ng, default s\u1ebd \u0111\u01b0\u1ee3c th\u1ef1c thi. H\u1eefu \xedch \u0111\u1ec3 th\u1ef1c hi\u1ec7n non-blocking send/receive ho\u1eb7c ki\u1ec3m tra tr\u1ea1ng th\xe1i."))),(0,i.kt)("p",null,"Cho ph\xe9p x\xe2y d\u1ef1ng c\xe1c logic \u0111i\u1ec1u ph\u1ed1i v\xe0 x\u1eed l\xfd s\u1ef1 ki\u1ec7n ph\u1ee9c t\u1ea1p t\u1eeb nhi\u1ec1u ngu\u1ed3n \u0111\u1ed3ng th\u1eddi m\u1ed9t c\xe1ch hi\u1ec7u qu\u1ea3."),(0,i.kt)("h3",{id:"c\xe1c-c\u01a1-ch\u1ebf-\u0111\u1ed3ng-b\u1ed9-h\xf3a-kh\xe1c-sync-package"},"C\xe1c C\u01a1 Ch\u1ebf \u0110\u1ed3ng B\u1ed9 H\xf3a Kh\xe1c (sync package)"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"sync.Mutex & sync.RWMutex"),": Cung c\u1ea5p c\u01a1 ch\u1ebf kh\xf3a (locking) truy\u1ec1n th\u1ed1ng \u0111\u1ec3 b\u1ea3o v\u1ec7 c\xe1c v\xf9ng t\xe0i nguy\xean chia s\u1ebb (critical sections) kh\u1ecfi data races. RWMutex cho ph\xe9p nhi\u1ec1u goroutine \u0111\u1ecdc \u0111\u1ed3ng th\u1eddi nh\u01b0ng ch\u1ec9 m\u1ed9t goroutine ghi t\u1ea1i m\u1ed9t th\u1eddi \u0111i\u1ec3m."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"sync.WaitGroup"),": Cung c\u1ea5p c\u01a1 ch\u1ebf \u0111\u1ec3 \u0111\u1ee3i m\u1ed9t nh\xf3m c\xe1c goroutine ho\xe0n th\xe0nh c\xf4ng vi\u1ec7c. S\u1eed d\u1ee5ng Add(delta), Done(), Wait()."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"sync.Once"),": \u0110\u1ea3m b\u1ea3o m\u1ed9t \u0111o\u1ea1n code ch\u1ec9 \u0111\u01b0\u1ee3c th\u1ef1c thi \u0111\xfang m\u1ed9t l\u1ea7n duy nh\u1ea5t, ngay c\u1ea3 khi \u0111\u01b0\u1ee3c g\u1ecdi t\u1eeb nhi\u1ec1u goroutine."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Context package"),": C\u1ef1c k\u1ef3 quan tr\u1ecdng \u0111\u1ec3 qu\u1ea3n l\xfd cancellation signals, deadlines, v\xe0 request-scoped values qua c\xe1c goroutine v\xe0 c\xe1c l\u1edbp API. Gi\xfap tr\xe1nh r\xf2 r\u1ec9 goroutine v\xe0 t\xe0i nguy\xean khi m\u1ed9t t\xe1c v\u1ee5 c\u1ea7n \u0111\u01b0\u1ee3c h\u1ee7y b\u1ecf."),(0,i.kt)("h2",{id:"concurrency-vs-parallelism-trong-go"},"Concurrency vs. Parallelism trong Go"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Concurrency (\u0110\u1ed3ng th\u1eddi)"),": L\xe0 kh\u1ea3 n\u0103ng x\u1eed l\xfd nhi\u1ec1u c\xf4ng vi\u1ec7c d\u01b0\u1eddng nh\u01b0 c\xf9ng m\u1ed9t l\xfac. Tr\xean m\u1ed9t l\xf5i CPU, Go runtime scheduler xen k\u1ebd vi\u1ec7c th\u1ef1c thi c\xe1c goroutine, t\u1ea1o c\u1ea3m gi\xe1c ch\xfang ch\u1ea1y song song. \u0110\xe2y l\xe0 v\u1ec1 c\u1ea5u tr\xfac ch\u01b0\u01a1ng tr\xecnh."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Parallelism (Song song)"),": L\xe0 kh\u1ea3 n\u0103ng th\u1ef1c s\u1ef1 th\u1ef1c thi nhi\u1ec1u c\xf4ng vi\u1ec7c ch\xednh x\xe1c t\u1ea1i c\xf9ng m\u1ed9t th\u1eddi \u0111i\u1ec3m. \u0110i\u1ec1u n\xe0y y\xeau c\u1ea7u nhi\u1ec1u l\xf5i CPU. Go runtime s\u1ebd ph\xe2n ph\u1ed1i c\xe1c goroutine ch\u1ea1y tr\xean c\xe1c OS threads kh\xe1c nhau, m\u1ed7i thread \u0111\u01b0\u1ee3c g\xe1n cho m\u1ed9t l\xf5i CPU (th\xf4ng qua bi\u1ebfn m\xf4i tr\u01b0\u1eddng GOMAXPROCS, m\u1eb7c \u0111\u1ecbnh b\u1eb1ng s\u1ed1 l\xf5i CPU). \u0110\xe2y l\xe0 v\u1ec1 th\u1ef1c thi."),(0,i.kt)("h4",{id:"so-s\xe1nh-\u0111\u01a1n-lu\u1ed3ng-vs-\u0111a-lu\u1ed3ng-goroutines"},"So s\xe1nh \u0110\u01a1n lu\u1ed3ng vs. \u0110a lu\u1ed3ng (Goroutines):"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u0110\u01a1n lu\u1ed3ng (Truy\u1ec1n th\u1ed1ng): M\u1ed9t t\xe1c v\u1ee5 ph\u1ea3i ho\xe0n th\xe0nh tr\u01b0\u1edbc khi t\xe1c v\u1ee5 ti\u1ebfp theo b\u1eaft \u0111\u1ea7u. N\u1ebfu m\u1ed9t t\xe1c v\u1ee5 b\u1ecb ch\u1eb7n (v\xed d\u1ee5: ch\u1edd I/O), to\xe0n b\u1ed9 lu\u1ed3ng b\u1ecb d\u1eebng.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u0110a lu\u1ed3ng (Goroutines):"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"I/O-bound Tasks: Khi m\u1ed9t goroutine b\u1ecb ch\u1eb7n b\u1edfi I/O (v\xed d\u1ee5: \u0111\u1ecdc file, g\u1ecdi m\u1ea1ng), Go runtime scheduler s\u1ebd chuy\u1ec3n OS thread \u0111\xf3 sang ch\u1ea1y m\u1ed9t goroutine kh\xe1c \u0111ang s\u1eb5n s\xe0ng. \u0110i\u1ec1u n\xe0y gi\xfap t\u1eadn d\u1ee5ng t\u1ed1i \u0111a CPU thay v\xec \u0111\u1ec3 n\xf3 nh\xe0n r\u1ed7i ch\u1edd I/O. \u0110\xe2y l\xe0 l\u1ee3i \xedch l\u1edbn c\u1ee7a concurrency.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"CPU-bound Tasks: Khi c\xe1c t\xe1c v\u1ee5 \u0111\xf2i h\u1ecfi t\xednh to\xe1n CPU li\xean t\u1ee5c, vi\u1ec7c ch\u1ea1y ch\xfang song song tr\xean nhi\u1ec1u l\xf5i CPU (parallelism) s\u1ebd t\u0103ng t\u1ed1c \u0111\u1ed9 x\u1eed l\xfd t\u1ed5ng th\u1ec3. Go scheduler s\u1ebd c\u1ed1 g\u1eafng ph\xe2n ph\u1ed1i c\xe1c goroutine n\xe0y l\xean c\xe1c P (Processor) kh\xe1c nhau \u0111\u1ec3 ch\u1ea1y tr\xean c\xe1c M (Machine/Thread) kh\xe1c nhau."))))),(0,i.kt)("p",null,"Go's concurrency model \u0111\u1eb7c bi\u1ec7t hi\u1ec7u qu\u1ea3 cho c\xe1c \u1ee9ng d\u1ee5ng I/O-bound (nh\u01b0 web servers, microservices) v\xec n\xf3 cho ph\xe9p x\u1eed l\xfd h\xe0ng ngh\xecn k\u1ebft n\u1ed1i \u0111\u1ed3ng th\u1eddi v\u1edbi chi ph\xed t\xe0i nguy\xean th\u1ea5p. N\xf3 c\u0169ng t\u1eadn d\u1ee5ng t\u1ed1t c\xe1c h\u1ec7 th\u1ed1ng \u0111a l\xf5i cho c\xe1c t\xe1c v\u1ee5 CPU-bound."),(0,i.kt)("h2",{id:"go-runtime-scheduler-gc-v\xe0-lightweight-threads"},"Go Runtime: Scheduler, GC v\xe0 Lightweight Threads"),(0,i.kt)("p",null,"Go runtime l\xe0 m\u1ed9t ph\u1ea7n quan tr\u1ecdng c\u1ee7a h\u1ec7 sinh th\xe1i Go, cung c\u1ea5p c\xe1c d\u1ecbch v\u1ee5 c\u1ed1t l\xf5i."),(0,i.kt)("h3",{id:"scheduler-gmp-model"},"Scheduler (GMP Model)"),(0,i.kt)("p",null,"Go s\u1eed d\u1ee5ng m\xf4 h\xecnh scheduler M:N, ngh\u0129a l\xe0 M goroutines \u0111\u01b0\u1ee3c \xe1nh x\u1ea1 l\xean N OS threads. M\xf4 h\xecnh c\u1ee5 th\u1ec3 l\xe0 GMP:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"G (Goroutine): \u0110\u1ea1i di\u1ec7n cho m\u1ed9t goroutine, bao g\u1ed3m stack, tr\u1ea1ng th\xe1i hi\u1ec7n t\u1ea1i, v\xe0 con tr\u1ecf l\u1ec7nh.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"M (Machine): \u0110\u1ea1i di\u1ec7n cho m\u1ed9t OS thread do h\u1ec7 \u0111i\u1ec1u h\xe0nh qu\u1ea3n l\xfd. M th\u1ef1c thi m\xe3 Go.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},'P (Processor): \u0110\u1ea1i di\u1ec7n cho m\u1ed9t "b\u1ed9 x\u1eed l\xfd logic", l\xe0 ng\u1eef c\u1ea3nh c\u1ea7n thi\u1ebft \u0111\u1ec3 M th\u1ef1c thi G. M\u1ed7i P c\xf3 m\u1ed9t h\xe0ng \u0111\u1ee3i c\xe1c goroutine c\xf3 th\u1ec3 ch\u1ea1y (local run queue - LRQ). S\u1ed1 l\u01b0\u1ee3ng P \u0111\u01b0\u1ee3c ki\u1ec3m so\xe1t b\u1edfi GOMAXPROCS.'))),(0,i.kt)("p",null,"Lu\u1ed3ng ho\u1ea1t \u0111\u1ed9ng:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"M\u1ed9t P l\u1ea5y m\u1ed9t G t\u1eeb h\xe0ng \u0111\u1ee3i c\u1ee5c b\u1ed9 (LRQ) c\u1ee7a n\xf3.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"P t\xecm m\u1ed9t M \u0111ang ch\u1edd (idle) ho\u1eb7c t\u1ea1o M m\u1edbi n\u1ebfu c\u1ea7n.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"P g\xe1n G cho M \u0111\u1ec3 th\u1ef1c thi.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"M th\u1ef1c thi G. N\u1ebfu G b\u1ecb block b\u1edfi system call, M s\u1ebd t\xe1ch kh\u1ecfi P v\xe0 P c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c m\u1ed9t M kh\xe1c s\u1eed d\u1ee5ng \u0111\u1ec3 ch\u1ea1y G kh\xe1c. Khi system call ho\xe0n th\xe0nh, M s\u1ebd c\u1ed1 g\u1eafng l\u1ea5y l\u1ea1i P c\u0169 ho\u1eb7c t\xecm P kh\xe1c.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},'N\u1ebfu LRQ c\u1ee7a m\u1ed9t P h\u1ebft G, n\xf3 s\u1ebd c\u1ed1 g\u1eafng "l\u1ea5y tr\u1ed9m" (work-stealing) G t\u1eeb LRQ c\u1ee7a P kh\xe1c ho\u1eb7c t\u1eeb h\xe0ng \u0111\u1ee3i to\xe0n c\u1ee5c (global run queue - GRQ) \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o c\xe1c M lu\xf4n b\u1eadn r\u1ed9n.'))),(0,i.kt)("p",null,"\u01afu \u0111i\u1ec3m: Hi\u1ec7u qu\u1ea3 cao, chi ph\xed context switching th\u1ea5p gi\u1eefa c\xe1c goroutine, kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng t\u1ed1t v\u1edbi s\u1ed1 l\u01b0\u1ee3ng l\u1edbn goroutine, t\u1eadn d\u1ee5ng t\u1ed1t c\xe1c l\xf5i CPU."),(0,i.kt)("h3",{id:"garbage-collector-gc"},"Garbage Collector (GC)"),(0,i.kt)("p",null,"Go cung c\u1ea5p b\u1ed9 thu gom r\xe1c t\u1ef1 \u0111\u1ed9ng (automatic garbage collection)."),(0,i.kt)("p",null,"Thu\u1eadt to\xe1n: S\u1eed d\u1ee5ng thu\u1eadt to\xe1n concurrent tri-color mark-and-sweep."),(0,i.kt)("p",null,"\u0110\u1eb7c \u0111i\u1ec3m:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},'Concurrent: H\u1ea7u h\u1ebft c\xe1c giai \u0111o\u1ea1n \u0111\xe1nh d\u1ea5u (marking) v\xe0 qu\xe9t (sweeping) ch\u1ea1y \u0111\u1ed3ng th\u1eddi v\u1edbi ch\u01b0\u01a1ng tr\xecnh ch\xednh (goroutines), gi\u1ea3m thi\u1ec3u th\u1eddi gian "Stop-The-World" (STW).')),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Tri-color: S\u1eed d\u1ee5ng ba m\xe0u (tr\u1eafng, x\xe1m, \u0111en) \u0111\u1ec3 theo d\xf5i c\xe1c \u0111\u1ed1i t\u01b0\u1ee3ng \u0111\xe3 \u0111\u01b0\u1ee3c qu\xe9t.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Write Barrier: M\u1ed9t c\u01a1 ch\u1ebf \u0111\u01b0\u1ee3c b\u1eadt trong giai \u0111o\u1ea1n \u0111\xe1nh d\u1ea5u \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o GC kh\xf4ng b\u1ecf s\xf3t c\xe1c con tr\u1ecf m\u1edbi \u0111\u01b0\u1ee3c t\u1ea1o ra ho\u1eb7c thay \u0111\u1ed5i b\u1edfi ch\u01b0\u01a1ng tr\xecnh ch\xednh trong khi GC \u0111ang ch\u1ea1y.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Low Latency: C\xe1c phi\xean b\u1ea3n Go hi\u1ec7n \u0111\u1ea1i c\xf3 th\u1eddi gian t\u1ea1m d\u1eebng STW r\u1ea5t ng\u1eafn (th\u01b0\u1eddng d\u01b0\u1edbi mili gi\xe2y, th\u1eadm ch\xed micro gi\xe2y), ph\xf9 h\u1ee3p cho c\xe1c \u1ee9ng d\u1ee5ng y\xeau c\u1ea7u \u0111\u1ed9 tr\u1ec5 th\u1ea5p."))),(0,i.kt)("p",null,"\u1ea2nh h\u01b0\u1edfng h\u1ec7 th\u1ed1ng: T\u1ef1 \u0111\u1ed9ng qu\u1ea3n l\xfd b\u1ed9 nh\u1edb heap, gi\u1ea3m g\xe1nh n\u1eb7ng cho l\u1eadp tr\xecnh vi\xean. M\u1eb7c d\xf9 GC c\xf3 chi ph\xed CPU nh\u1ea5t \u0111\u1ecbnh, thi\u1ebft k\u1ebf concurrent c\u1ee7a n\xf3 gi\xfap gi\u1ea3m thi\u1ec3u \u1ea3nh h\u01b0\u1edfng \u0111\u1ebfn hi\u1ec7u n\u0103ng \u1ee9ng d\u1ee5ng."),(0,i.kt)("h3",{id:"lightweight-threads"},"Lightweight Threads"),(0,i.kt)("p",null,"C\u1ea7n nh\u1ea5n m\u1ea1nh l\u1ea1i: Goroutines kh\xf4ng ph\u1ea3i l\xe0 OS threads. Ch\xfang l\xe0 m\u1ed9t kh\xe1i ni\u1ec7m tr\u1eebu t\u01b0\u1ee3ng nh\u1eb9 h\u01a1n, \u0111\u01b0\u1ee3c Go runtime multiplex (gh\xe9p k\xeanh) l\xean m\u1ed9t nh\xf3m nh\u1ecf c\xe1c OS threads (M)."),(0,i.kt)("h2",{id:"qu\u1ea3n-l\xfd-b\u1ed9-nh\u1edb-stack-heap-escape-analysis-v\xe0-profiling"},"Qu\u1ea3n L\xfd B\u1ed9 Nh\u1edb: Stack, Heap, Escape Analysis v\xe0 Profiling"),(0,i.kt)("h3",{id:"stack-vs-heap-allocation"},"Stack vs. Heap Allocation"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Stack"),": M\u1ed7i goroutine c\xf3 m\u1ed9t v\xf9ng nh\u1edb stack ri\xeang. Vi\u1ec7c c\u1ea5p ph\xe1t v\xe0 gi\u1ea3i ph\xf3ng tr\xean stack r\u1ea5t nhanh (ch\u1ec9 c\u1ea7n thay \u0111\u1ed5i con tr\u1ecf stack). Go compiler c\u1ed1 g\u1eafng c\u1ea5p ph\xe1t bi\u1ebfn c\u1ee5c b\u1ed9 tr\xean stack c\u1ee7a goroutine t\u1ea1o ra n\xf3. B\u1ed9 nh\u1edb stack \u0111\u01b0\u1ee3c gi\u1ea3i ph\xf3ng t\u1ef1 \u0111\u1ed9ng khi h\xe0m k\u1ebft th\xfac."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Heap"),': L\xe0 v\xf9ng nh\u1edb chung cho to\xe0n b\u1ed9 \u1ee9ng d\u1ee5ng, \u0111\u01b0\u1ee3c qu\u1ea3n l\xfd b\u1edfi GC. Vi\u1ec7c c\u1ea5p ph\xe1t tr\xean heap ch\u1eadm h\u01a1n v\xe0 t\u1ea1o \xe1p l\u1ef1c l\xean GC. Bi\u1ebfn \u0111\u01b0\u1ee3c c\u1ea5p ph\xe1t tr\xean heap khi compiler x\xe1c \u0111\u1ecbnh r\u1eb1ng bi\u1ebfn \u0111\xf3 c\xf3 th\u1ec3 v\u1eabn \u0111\u01b0\u1ee3c tham chi\u1ebfu sau khi h\xe0m t\u1ea1o ra n\xf3 k\u1ebft th\xfac (n\xf3 "escapes" - tho\xe1t kh\u1ecfi stack).'),(0,i.kt)("h3",{id:"escape-analysis-ph\xe2n-t\xedch-tho\xe1t"},"Escape Analysis (Ph\xe2n t\xedch Tho\xe1t)"),(0,i.kt)("p",null,'\u0110\xe2y l\xe0 qu\xe1 tr\xecnh compiler th\u1ef1c hi\u1ec7n \u0111\u1ec3 x\xe1c \u0111\u1ecbnh xem m\u1ed9t bi\u1ebfn c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c c\u1ea5p ph\xe1t an to\xe0n tr\xean stack hay ph\u1ea3i "tho\xe1t" ra heap.'),(0,i.kt)("p",null,'C\xe1ch ki\u1ec3m tra: go build -gcflags="-m" ho\u1eb7c go run -gcflags="-m" main.go. Output s\u1ebd ch\u1ec9 ra bi\u1ebfn n\xe0o b\u1ecb di chuy\u1ec3n l\xean heap.'),(0,i.kt)("p",null,'L\xfd do bi\u1ebfn "tho\xe1t":'),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Chia s\u1ebb qua goroutines: G\u1eedi con tr\u1ecf \u0111\u1ebfn bi\u1ebfn qua channel ho\u1eb7c truy c\u1eadp bi\u1ebfn t\u1eeb m\u1ed9t goroutine kh\xe1c.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Tr\u1ea3 v\u1ec1 con tr\u1ecf: H\xe0m tr\u1ea3 v\u1ec1 con tr\u1ecf \u0111\u1ebfn m\u1ed9t bi\u1ebfn c\u1ee5c b\u1ed9.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},'Closure: Bi\u1ebfn c\u1ee5c b\u1ed9 \u0111\u01b0\u1ee3c "capture" b\u1edfi m\u1ed9t closure (h\xe0m l\u1ed3ng) m\xe0 closure n\xe0y c\xf3 th\u1ec3 t\u1ed3n t\u1ea1i l\xe2u h\u01a1n h\xe0m ch\u1ee9a bi\u1ebfn \u0111\xf3.')),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"K\xedch th\u01b0\u1edbc kh\xf4ng x\xe1c \u0111\u1ecbnh: C\u1ea5p ph\xe1t slice v\u1edbi k\xedch th\u01b0\u1edbc kh\xf4ng x\xe1c \u0111\u1ecbnh t\u1ea1i compile time.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"G\xe1n cho interface: G\xe1n gi\xe1 tr\u1ecb (\u0111\u1eb7c bi\u1ec7t l\xe0 con tr\u1ecf) cho m\u1ed9t bi\u1ebfn ki\u1ec3u interface th\u01b0\u1eddng khi\u1ebfn gi\xe1 tr\u1ecb g\u1ed1c tho\xe1t ra heap."))),(0,i.kt)("p",null,"\u1ea2nh h\u01b0\u1edfng: Vi\u1ec7c bi\u1ebfn tho\xe1t ra heap l\xe0m t\u0103ng s\u1ed1 l\u01b0\u1ee3ng c\u1ea5p ph\xe1t b\u1ed9 nh\u1edb \u0111\u1ed9ng v\xe0 t\u0103ng g\xe1nh n\u1eb7ng cho GC, c\xf3 th\u1ec3 \u1ea3nh h\u01b0\u1edfng \u0111\u1ebfn hi\u1ec7u n\u0103ng. Hi\u1ec3u escape analysis gi\xfap vi\u1ebft code hi\u1ec7u qu\u1ea3 h\u01a1n v\u1ec1 m\u1eb7t b\u1ed9 nh\u1edb."),(0,i.kt)("h3",{id:"profiling-v\u1edbi-pprof"},"Profiling v\u1edbi pprof"),(0,i.kt)("p",null,"pprof l\xe0 c\xf4ng c\u1ee5 profiling ti\xeau chu\u1ea9n c\u1ee7a Go, c\u1ef1c k\u1ef3 m\u1ea1nh m\u1ebd \u0111\u1ec3 ph\xe2n t\xedch hi\u1ec7u n\u0103ng v\xe0 s\u1eed d\u1ee5ng b\u1ed9 nh\u1edb."),(0,i.kt)("p",null,"C\xe1ch t\xedch h\u1ee3p (cho web server):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'import _ "net/http/pprof" // Import \u1ea9n danh \u0111\u1ec3 \u0111\u0103ng k\xfd c\xe1c HTTP handler\nimport "net/http"\nimport "log"\n\nfunc main() {\n// ... your application setup ...\n\n    // Start pprof server on a separate port (recommended)\n    go func() {\n        log.Println(http.ListenAndServe("localhost:6060", nil))\n    }()\n\n    // ... start your main application server ...\n\n}\n')),(0,i.kt)("p",null,"C\xe1c lo\u1ea1i Profile ph\u1ed5 bi\u1ebfn:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"CPU Profile: Xem h\xe0m n\xe0o t\u1ed1n nhi\u1ec1u th\u1eddi gian CPU nh\u1ea5t.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Heap Profile: Xem h\xe0m n\xe0o c\u1ea5p ph\xe1t nhi\u1ec1u b\u1ed9 nh\u1edb heap nh\u1ea5t (c\u1ea3 \u0111ang s\u1eed d\u1ee5ng v\xe0 \u0111\xe3 c\u1ea5p ph\xe1t).")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Goroutine Profile: Xem stack trace c\u1ee7a t\u1ea5t c\u1ea3 c\xe1c goroutine \u0111ang ch\u1ea1y (h\u1eefu \xedch \u0111\u1ec3 debug deadlock ho\u1eb7c r\xf2 r\u1ec9 goroutine).")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Mutex Profile: Xem c\xe1c \u0111i\u1ec3m tranh ch\u1ea5p mutex (lock contention).")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Block Profile: Xem c\xe1c \u0111i\u1ec3m m\xe0 goroutine b\u1ecb block (ch\u1edd channel, mutex, syscall)."))),(0,i.kt)("p",null,"C\xe1ch s\u1eed d\u1ee5ng:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Web UI: Truy c\u1eadp ",(0,i.kt)("inlineCode",{parentName:"p"},"http://localhost:6060/debug/pprof/")," trong tr\xecnh duy\u1ec7t.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Command Line: ",(0,i.kt)("inlineCode",{parentName:"p"},"go tool pprof http://localhost:6060/debug/pprof/heap")," ho\u1eb7c ",(0,i.kt)("inlineCode",{parentName:"p"},"go tool pprof <binary> <profile_file>"),". Cung c\u1ea5p giao di\u1ec7n t\u01b0\u01a1ng t\xe1c \u0111\u1ec3 ph\xe2n t\xedch (v\xed d\u1ee5: top, list functionName, web)."))),(0,i.kt)("p",null,"\u1ea2nh h\u01b0\u1edfng: pprof l\xe0 c\xf4ng c\u1ee5 kh\xf4ng th\u1ec3 thi\u1ebfu \u0111\u1ec3 t\xecm v\xe0 s\u1eeda c\xe1c v\u1ea5n \u0111\u1ec1 v\u1ec1 hi\u1ec7u n\u0103ng v\xe0 b\u1ed9 nh\u1edb trong c\xe1c \u1ee9ng d\u1ee5ng Go ph\u1ee9c t\u1ea1p."),(0,i.kt)("h2",{id:"c\xe1c-m\u1eabu-concurrency-ph\u1ed5-bi\u1ebfn"},"C\xe1c M\u1eabu Concurrency Ph\u1ed5 Bi\u1ebfn"),(0,i.kt)("p",null,"Go's concurrency primitives cho ph\xe9p x\xe2y d\u1ef1ng nhi\u1ec1u m\u1eabu thi\u1ebft k\u1ebf m\u1ea1nh m\u1ebd."),(0,i.kt)("h4",{id:"worker-pools"},"Worker Pools"),(0,i.kt)("p",null,"M\u1ee5c \u0111\xedch: Gi\u1edbi h\u1ea1n s\u1ed1 l\u01b0\u1ee3ng goroutine ch\u1ea1y \u0111\u1ed3ng th\u1eddi \u0111\u1ec3 x\u1eed l\xfd m\u1ed9t l\u01b0\u1ee3ng l\u1edbn c\xf4ng vi\u1ec7c, tr\xe1nh ti\xeau t\u1ed1n qu\xe1 nhi\u1ec1u t\xe0i nguy\xean (CPU, RAM, file descriptors,...)."),(0,i.kt)("p",null,"C\u1ea5u tr\xfac:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"M\u1ed9t channel (tasks) \u0111\u1ec3 g\u1eedi c\xf4ng vi\u1ec7c c\u1ea7n x\u1eed l\xfd.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"M\u1ed9t nh\xf3m goroutines (workers) v\u1edbi s\u1ed1 l\u01b0\u1ee3ng c\u1ed1 \u0111\u1ecbnh. M\u1ed7i worker \u0111\u1ecdc c\xf4ng vi\u1ec7c t\u1eeb tasks channel.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"(T\xf9y ch\u1ecdn) M\u1ed9t channel (results) \u0111\u1ec3 workers g\u1eedi k\u1ebft qu\u1ea3 v\u1ec1.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"S\u1eed d\u1ee5ng sync.WaitGroup \u0111\u1ec3 ch\u1edd t\u1ea5t c\u1ea3 workers ho\xe0n th\xe0nh khi kh\xf4ng c\xf2n task n\xe0o."))),(0,i.kt)("h4",{id:"fan-out--fan-in"},"Fan-out / Fan-in"),(0,i.kt)("p",null,"Fan-out: M\u1ed9t goroutine (producer) ph\xe2n ph\u1ed1i c\xf4ng vi\u1ec7c cho nhi\u1ec1u goroutine kh\xe1c (workers) th\xf4ng qua nhi\u1ec1u channels ho\u1eb7c m\u1ed9t channel chung."),(0,i.kt)("p",null,"Fan-in: Nhi\u1ec1u goroutine (workers) g\u1eedi k\u1ebft qu\u1ea3 c\u1ee7a ch\xfang v\xe0o m\u1ed9t channel duy nh\u1ea5t (consumer). Consumer t\u1ed5ng h\u1ee3p ho\u1eb7c x\u1eed l\xfd c\xe1c k\u1ebft qu\u1ea3 n\xe0y."),(0,i.kt)("p",null,"K\u1ebft h\u1ee3p: Th\u01b0\u1eddng \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng c\xf9ng nhau. V\xed d\u1ee5: M\u1ed9t producer fan-out c\xf4ng vi\u1ec7c cho m\u1ed9t worker pool, v\xe0 c\xe1c workers fan-in k\u1ebft qu\u1ea3 v\u1ec1 m\u1ed9t consumer duy nh\u1ea5t."),(0,i.kt)("h2",{id:"nh\u1eefng-kh\xe1i-ni\u1ec7m-golang-chuy\xean-s\xe2u-\xedt-ng\u01b0\u1eddi-bi\u1ebft"},"Nh\u1eefng Kh\xe1i Ni\u1ec7m Golang Chuy\xean S\xe2u \xcdt Ng\u01b0\u1eddi Bi\u1ebft"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"sync.Pool:")),(0,i.kt)("p",null,"M\u1ee5c \u0111\xedch: Cung c\u1ea5p m\u1ed9t c\xe1ch \u0111\u1ec3 t\xe1i s\u1eed d\u1ee5ng c\xe1c \u0111\u1ed1i t\u01b0\u1ee3ng \u0111\xe3 c\u1ea5p ph\xe1t nh\u01b0ng kh\xf4ng c\xf2n d\xf9ng \u0111\u1ebfn, thay v\xec \u0111\u1ec3 GC thu d\u1ecdn ch\xfang ngay l\u1eadp t\u1ee9c. Gi\xfap gi\u1ea3m \xe1p l\u1ef1c GC cho c\xe1c \u0111\u1ed1i t\u01b0\u1ee3ng \u0111\u01b0\u1ee3c c\u1ea5p ph\xe1t v\xe0 gi\u1ea3i ph\xf3ng th\u01b0\u1eddng xuy\xean (v\xed d\u1ee5: buffer, \u0111\u1ed1i t\u01b0\u1ee3ng request t\u1ea1m th\u1eddi)."),(0,i.kt)("p",null,"L\u01b0u \xfd: sync.Pool kh\xf4ng \u0111\u1ea3m b\u1ea3o \u0111\u1ed1i t\u01b0\u1ee3ng l\u1ea5y ra l\xe0 c\xe1i \u0111\xe3 Put v\xe0o tr\u01b0\u1edbc \u0111\xf3. C\xe1c \u0111\u1ed1i t\u01b0\u1ee3ng trong Pool c\xf3 th\u1ec3 b\u1ecb GC thu d\u1ecdn b\u1ea5t c\u1ee9 l\xfac n\xe0o, \u0111\u1eb7c bi\u1ec7t l\xe0 gi\u1eefa c\xe1c chu k\u1ef3 GC. Kh\xf4ng n\xean d\xf9ng cho c\xe1c \u0111\u1ed1i t\u01b0\u1ee3ng c\u1ea7n duy tr\xec tr\u1ea1ng th\xe1i quan tr\u1ecdng."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Race Detector:")),(0,i.kt)("p",null,"M\u1ee5c \u0111\xedch: Ph\xe1t hi\u1ec7n c\xe1c l\u1ed7i data race (khi nhi\u1ec1u goroutine truy c\u1eadp c\xf9ng m\u1ed9t bi\u1ebfn m\xe0 kh\xf4ng c\xf3 \u0111\u1ed3ng b\u1ed9 h\xf3a v\xe0 \xedt nh\u1ea5t m\u1ed9t truy c\u1eadp l\xe0 ghi) t\u1ea1i runtime. Data race l\xe0 l\u1ed7i r\u1ea5t kh\xf3 debug."),(0,i.kt)("p",null,"C\xe1ch d\xf9ng: Th\xeam flag -race khi build, run ho\u1eb7c test: go run -race main.go, go test -race ./...."),(0,i.kt)("p",null,"L\u01b0u \xfd: B\u1eadt race detector l\xe0m ch\u1eadm ch\u01b0\u01a1ng tr\xecnh v\xe0 t\u0103ng s\u1eed d\u1ee5ng b\u1ed9 nh\u1edb, ch\u1ec9 n\xean d\xf9ng trong qu\xe1 tr\xecnh ph\xe1t tri\u1ec3n v\xe0 testing."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Build Tags (Build Constraints):")),(0,i.kt)("p",null,"M\u1ee5c \u0111\xedch: Cho ph\xe9p bi\xean d\u1ecbch c\xf3 \u0111i\u1ec1u ki\u1ec7n c\xe1c file ho\u1eb7c \u0111o\u1ea1n code d\u1ef1a tr\xean c\xe1c tag \u0111\u01b0\u1ee3c cung c\u1ea5p l\xfac build. H\u1eefu \xedch \u0111\u1ec3 vi\u1ebft code cho c\xe1c h\u1ec7 \u0111i\u1ec1u h\xe0nh/ki\u1ebfn tr\xfac kh\xe1c nhau ho\u1eb7c t\u1ea1o c\xe1c phi\xean b\u1ea3n build kh\xe1c nhau (v\xed d\u1ee5: debug vs. release)."),(0,i.kt)("p",null,'C\xe1ch d\xf9ng: Th\xeam comment //go:build mytag \u1edf \u0111\u1ea7u file Go. Build v\u1edbi go build -tags="mytag".'),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"cgo:")),(0,i.kt)("p",null,"M\u1ee5c \u0111\xedch: Cho ph\xe9p Go g\u1ecdi code C (v\xe0 ng\u01b0\u1ee3c l\u1ea1i)."),(0,i.kt)("p",null,'C\xe1ch d\xf9ng: import "C". Vi\u1ebft code C trong comment \u0111\u1eb7c bi\u1ec7t ph\xeda tr\xean import.'),(0,i.kt)("p",null,"\u1ea2nh h\u01b0\u1edfng: G\u1ecdi t\u1eeb Go sang C (v\xe0 ng\u01b0\u1ee3c l\u1ea1i) c\xf3 chi ph\xed context switching \u0111\xe1ng k\u1ec3. cgo c\u0169ng c\xf3 th\u1ec3 \u1ea3nh h\u01b0\u1edfng \u0111\u1ebfn vi\u1ec7c qu\u1ea3n l\xfd stack c\u1ee7a goroutine v\xe0 t\u01b0\u01a1ng t\xe1c v\u1edbi Go scheduler/GC. N\xean h\u1ea1n ch\u1ebf s\u1eed d\u1ee5ng n\u1ebfu kh\xf4ng th\u1ef1c s\u1ef1 c\u1ea7n thi\u1ebft."))}p.isMDXComponent=!0}}]);