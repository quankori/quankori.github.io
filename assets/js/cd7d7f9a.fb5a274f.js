"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[462],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>d});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=r.createContext({}),p=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=p(e.components);return r.createElement(i.Provider,{value:t},e.children)},u="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,c=e.originalType,i=e.parentName,s=a(e,["components","mdxType","originalType","parentName"]),u=p(n),m=o,d=u["".concat(i,".").concat(m)]||u[m]||g[m]||c;return n?r.createElement(d,l(l({ref:t},s),{},{components:n})):r.createElement(d,l({ref:t},s))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var c=n.length,l=new Array(c);l[0]=m;var a={};for(var i in t)hasOwnProperty.call(t,i)&&(a[i]=t[i]);a.originalType=e,a[u]="string"==typeof e?e:o,l[1]=a;for(var p=2;p<c;p++)l[p]=n[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},348:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>g,frontMatter:()=>c,metadata:()=>a,toc:()=>p});var r=n(7462),o=(n(7294),n(3905));const c={title:"Interceptor"},l=void 0,a={unversionedId:"programming/nestjs/interceptor",id:"programming/nestjs/interceptor",title:"Interceptor",description:"Concept",source:"@site/docs/programming/nestjs/interceptor.md",sourceDirName:"programming/nestjs",slug:"/programming/nestjs/interceptor",permalink:"/docs/programming/nestjs/interceptor",draft:!1,tags:[],version:"current",frontMatter:{title:"Interceptor"},sidebar:"programming",previous:{title:"Authentication",permalink:"/docs/programming/nestjs/authentication"},next:{title:"Decorators",permalink:"/docs/programming/nestjs/decorators"}},i={},p=[{value:"Concept",id:"concept",level:2},{value:"Code",id:"code",level:2}],s={toc:p},u="wrapper";function g(e){let{components:t,...n}=e;return(0,o.kt)(u,(0,r.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"concept"},"Concept"),(0,o.kt)("p",null,"Trong NestJS, Interceptor l\xe0 m\u1ed9t ph\u1ea7n c\u1ee7a middleware pipeline v\xe0 cho ph\xe9p b\u1ea1n th\u1ef1c hi\u1ec7n c\xe1c thay \u0111\u1ed5i ho\u1eb7c x\u1eed l\xfd tr\u01b0\u1edbc v\xe0 sau khi y\xeau c\u1ea7u \u0111i qua controller tr\u01b0\u1edbc khi \u0111\u1ebfn response. Interceptor th\u01b0\u1eddng \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng \u0111\u1ec3 th\u1ef1c hi\u1ec7n c\xe1c t\xe1c v\u1ee5 nh\u01b0 logging, transform d\u1eef li\u1ec7u, validate, g\u1eafn metadata, v\xe0 nhi\u1ec1u c\xf4ng vi\u1ec7c x\u1eed l\xfd kh\xe1c."),(0,o.kt)("p",null,"Interceptors gi\xfap t\xe1ch logic x\u1eed l\xfd \u1ee9ng d\u1ee5ng th\xe0nh c\xe1c l\u1edbp ri\xeang bi\u1ec7t v\xe0 th\u1ef1c hi\u1ec7n c\xe1c t\xe1c v\u1ee5 x\u1eed l\xfd kh\xe1c nhau tr\u01b0\u1edbc v\xe0 sau khi x\u1eed l\xfd request, gi\xfap t\u0103ng kh\u1ea3 n\u0103ng qu\u1ea3n l\xfd v\xe0 t\xe1i s\u1eed d\u1ee5ng code."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Workflow c\u1ee7a Interceptor trong \u1ee9ng d\u1ee5ng th\u1ef1c t\u1ebf:")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Y\xeau c\u1ea7u g\u1eedi t\u1eeb client \u0111\u1ebfn server."),(0,o.kt)("li",{parentName:"ol"},"Interceptor tr\u01b0\u1edbc request ch\u1ea1y (n\u1ebfu c\xf3). Ch\u1eb3ng h\u1ea1n, logging request, validate d\u1eef li\u1ec7u, g\u1eafn metadata, v.v."),(0,o.kt)("li",{parentName:"ol"},"Y\xeau c\u1ea7u ti\u1ebfp t\u1ee5c v\xe0o controller \u0111\u1ec3 x\u1eed l\xfd."),(0,o.kt)("li",{parentName:"ol"},"Controller x\u1eed l\xfd y\xeau c\u1ea7u."),(0,o.kt)("li",{parentName:"ol"},"Interceptor sau request ch\u1ea1y (n\u1ebfu c\xf3). Ch\u1eb3ng h\u1ea1n, logging response, transform d\u1eef li\u1ec7u, g\u1eafn headers, v.v."),(0,o.kt)("li",{parentName:"ol"},"Response \u0111\u01b0\u1ee3c tr\u1ea3 v\u1ec1 cho client.")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/quankori/quankori.github.io/master/src/images/nestjs/6.png",alt:"Image"})),(0,o.kt)("h2",{id:"code"},"Code"),(0,o.kt)("p",null,"Tri\u1ec3n khai Interceptor"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'export interface Response<T> {\n  code: number;\n  message: string;\n  data: T;\n}\n\n@Injectable()\nexport class TestInterceptor<T> implements NestInterceptor<T, Response<T>> {\n  intercept(\n    context: ExecutionContext,\n    next: CallHandler<T>\n  ): Observable<Response<T>> {\n    console.log("Before request handled by controller");\n\n    return next.handle().pipe(\n      map((data) => {\n        console.log("After request handled by controller");\n        return {\n          data: data,\n          message: "Test",\n          code: context.switchToHttp().getResponse().statusCode,\n        };\n      })\n    );\n  }\n}\n')),(0,o.kt)("p",null,"S\u1eed d\u1ee5ng TransformInterceptor"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'import { Controller, Get, UseInterceptors } from "@nestjs/common";\nimport { TransformInterceptor } from "./transform.interceptor";\n\n@Controller("app")\n@UseInterceptors(TransformInterceptor)\nexport class AppController {\n  @Get()\n  getHello(): string {\n    return "Hello World";\n  }\n}\n')),(0,o.kt)("p",null,"Ho\u1eb7c s\u1eed d\u1ee5ng global"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"app.useGlobalInterceptors(new TestInterceptor(new Reflector()));\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Observer")),(0,o.kt)("p",null,"Trong RxJS, Observable l\xe0 m\u1ed9t ki\u1ec3u d\u1eef li\u1ec7u bi\u1ec3u di\u1ec5n m\u1ed9t lu\u1ed3ng d\u1eef li\u1ec7u kh\xf4ng \u0111\u1ed3ng b\u1ed9. N\xf3 cho ph\xe9p b\u1ea1n theo d\xf5i c\xe1c s\u1ef1 ki\u1ec7n, thay \u0111\u1ed5i, ho\u1eb7c gi\xe1 tr\u1ecb trong th\u1eddi gian v\xe0 th\u1ef1c hi\u1ec7n c\xe1c x\u1eed l\xfd t\u01b0\u01a1ng \u1ee9ng khi c\xf3 s\u1ef1 thay \u0111\u1ed5i. \u0110i\u1ec1u n\xe0y r\u1ea5t h\u1eefu \xedch \u0111\u1ec3 x\u1eed l\xfd c\xe1c t\xe1c v\u1ee5 kh\xf4ng \u0111\u1ed3ng b\u1ed9 nh\u01b0 t\u01b0\u01a1ng t\xe1c v\u1edbi API, x\u1eed l\xfd d\u1eef li\u1ec7u t\u1eeb c\u01a1 s\u1edf d\u1eef li\u1ec7u, v\xe0 nhi\u1ec1u t\xe1c v\u1ee5 kh\xe1c."),(0,o.kt)("p",null,"M\u1ed9t Observable c\xf3 th\u1ec3 ph\xe1t ra c\xe1c gi\xe1 tr\u1ecb (data), th\xf4ng b\xe1o l\u1ed7i (error), ho\u1eb7c th\xf4ng b\xe1o ho\xe0n th\xe0nh (complete) \u0111\u1ec3 k\u1ebft th\xfac lu\u1ed3ng d\u1eef li\u1ec7u. B\u1ea1n c\xf3 th\u1ec3 \xe1p d\u1ee5ng c\xe1c operator c\u1ee7a RxJS \u0111\u1ec3 bi\u1ebfn \u0111\u1ed5i, l\u1ecdc, k\u1ebft h\u1ee3p, v\xe0 x\u1eed l\xfd d\u1eef li\u1ec7u trong lu\u1ed3ng Observable"))}g.isMDXComponent=!0}}]);