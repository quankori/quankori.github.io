"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2310],{3905:(t,e,n)=>{n.d(e,{Zo:()=>s,kt:()=>k});var c=n(7294);function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);e&&(c=c.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,c)}return n}function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e){if(null==t)return{};var n,c,i=function(t,e){if(null==t)return{};var n,c,i={},a=Object.keys(t);for(c=0;c<a.length;c++)n=a[c],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(c=0;c<a.length;c++)n=a[c],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var l=c.createContext({}),h=function(t){var e=c.useContext(l),n=e;return t&&(n="function"==typeof t?t(e):r(r({},e),t)),n},s=function(t){var e=h(t.components);return c.createElement(l.Provider,{value:e},t.children)},p="mdxType",m={inlineCode:"code",wrapper:function(t){var e=t.children;return c.createElement(c.Fragment,{},e)}},u=c.forwardRef((function(t,e){var n=t.components,i=t.mdxType,a=t.originalType,l=t.parentName,s=o(t,["components","mdxType","originalType","parentName"]),p=h(n),u=i,k=p["".concat(l,".").concat(u)]||p[u]||m[u]||a;return n?c.createElement(k,r(r({ref:e},s),{},{components:n})):c.createElement(k,r({ref:e},s))}));function k(t,e){var n=arguments,i=e&&e.mdxType;if("string"==typeof t||i){var a=n.length,r=new Array(a);r[0]=u;var o={};for(var l in e)hasOwnProperty.call(e,l)&&(o[l]=e[l]);o.originalType=t,o[p]="string"==typeof t?t:i,r[1]=o;for(var h=2;h<a;h++)r[h]=n[h];return c.createElement.apply(null,r)}return c.createElement.apply(null,n)}u.displayName="MDXCreateElement"},5369:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>r,default:()=>m,frontMatter:()=>a,metadata:()=>o,toc:()=>h});var c=n(7462),i=(n(7294),n(3905));const a={title:"Event Loop"},r=void 0,o={unversionedId:"programming/nodejs/event-loop",id:"programming/nodejs/event-loop",title:"Event Loop",description:"Concept",source:"@site/docs/programming/nodejs/event-loop.md",sourceDirName:"programming/nodejs",slug:"/programming/nodejs/event-loop",permalink:"/docs/programming/nodejs/event-loop",draft:!1,tags:[],version:"current",frontMatter:{title:"Event Loop"}},l={},h=[{value:"Concept",id:"concept",level:2},{value:"MicroTask v\xe0 Macro Task",id:"microtask-v\xe0-macro-task",level:2},{value:"process.nextTick() and setImmediate() in Event Loop",id:"processnexttick-and-setimmediate-in-event-loop",level:2},{value:"process.nextTick()",id:"processnexttick",level:3},{value:"setImmediate()",id:"setimmediate",level:3}],s={toc:h},p="wrapper";function m(t){let{components:e,...n}=t;return(0,i.kt)(p,(0,c.Z)({},s,n,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"concept"},"Concept"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Khi g\u1eedi m\u1ed9t y\xeau c\u1ea7u b\u1ea5t \u0111\u1ed3ng b\u1ed9, nh\u01b0 y\xeau c\u1ea7u HTTP, Node.js kh\xf4ng \u0111\u1ee3i y\xeau c\u1ea7u \u0111\xf3 ho\xe0n th\xe0nh tr\u01b0\u1edbc khi ti\u1ebfp t\u1ee5c th\u1ef1c thi c\xe1c y\xeau c\u1ea7u kh\xe1c. Thay v\xe0o \u0111\xf3, Node.js g\u1eedi y\xeau c\u1ea7u \u0111\xf3 t\u1edbi h\u1ec7 th\u1ed1ng v\xe0 ti\u1ebfp t\u1ee5c th\u1ef1c thi c\xe1c y\xeau c\u1ea7u kh\xe1c. Khi y\xeau c\u1ea7u \u0111\xf3 ho\xe0n th\xe0nh, h\u1ec7 th\u1ed1ng th\xf4ng b\xe1o cho Node.js r\u1eb1ng y\xeau c\u1ea7u \u0111\xe3 ho\xe0n th\xe0nh, v\xe0 Node.js ti\u1ebfp t\u1ee5c th\u1ef1c thi c\xe1c nhi\u1ec7m v\u1ee5 kh\xe1c.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"C\xe1c nhi\u1ec7m v\u1ee5 trong v\xf2ng l\u1eb7p s\u1ef1 ki\u1ec7n \u0111\u01b0\u1ee3c x\u1ebfp h\xe0ng trong c\xe1c h\xe0ng \u0111\u1ee3i kh\xe1c nhau, bao g\u1ed3m:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Task queue (also known as a callback queue): Ch\u1ee9a c\xe1c h\xe0m callback \u0111\u01b0\u1ee3c g\u1ecdi khi m\u1ed9t y\xeau c\u1ea7u b\u1ea5t \u0111\u1ed3ng b\u1ed9 k\u1ebft th\xfac.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Microtask queue: Ch\u1ee9a c\xe1c h\xe0m callback \u0111\u01b0\u1ee3c g\u1ecdi khi m\u1ed9t promise \u0111\u01b0\u1ee3c gi\u1ea3i quy\u1ebft ho\u1eb7c b\u1ecb t\u1eeb ch\u1ed1i.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Timers queue: Ch\u1ee9a c\xe1c h\xe0m callback \u0111\u01b0\u1ee3c g\u1ecdi khi m\u1ed9t th\u1eddi gian ho\u1eb7c h\u1eb9n gi\u1edd (timeout ho\u1eb7c interval) \u0111\u01b0\u1ee3c k\xedch ho\u1ea1t.")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Khi v\xf2ng l\u1eb7p s\u1ef1 ki\u1ec7n b\u1eaft \u0111\u1ea7u, n\xf3 th\u1ef1c thi c\xe1c nhi\u1ec7m v\u1ee5 trong h\xe0ng \u0111\u1ee3i microtask tr\u01b0\u1edbc, sau \u0111\xf3 l\xe0 h\xe0ng \u0111\u1ee3i nhi\u1ec7m v\u1ee5, v\xe0 cu\u1ed1i c\xf9ng l\xe0 h\xe0ng \u0111\u1ee3i timers.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Khi m\u1ed9t nhi\u1ec7m v\u1ee5 \u0111\u01b0\u1ee3c th\u1ef1c thi, Node.js \u0111\u1eb7t n\xf3 v\xe0o m\u1ed9t v\xf2ng l\u1eb7p v\xf4 t\u1eadn \u0111\u1ec3 \u0111\u1ee3i c\xe1c nhi\u1ec7m v\u1ee5 kh\xe1c. Trong l\xfac \u0111\u1ee3i, Node.js ti\u1ebfp t\u1ee5c th\u1ef1c thi c\xe1c nhi\u1ec7m v\u1ee5 trong h\xe0ng \u0111\u1ee3i v\xf2ng l\u1eb7p s\u1ef1 ki\u1ec7n."))),(0,i.kt)("h2",{id:"microtask-v\xe0-macro-task"},"MicroTask v\xe0 Macro Task"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Microtask Queue (Job Queue)"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"C\xe1c nhi\u1ec7m v\u1ee5 microtask l\xe0 c\xe1c t\xe1c v\u1ee5 nh\u1eb9 v\xe0 \u01b0u ti\xean h\u01a1n so v\u1edbi c\xe1c t\xe1c v\u1ee5 kh\xe1c."),(0,i.kt)("li",{parentName:"ul"},"C\xe1c t\xe1c v\u1ee5 microtask bao g\u1ed3m c\xe1c promise callbacks, MutationObserver callbacks, v\xe0 t\xe1c v\u1ee5 \u0111\u1ee3i c\u1ee7a API nh\u01b0 process.nextTick trong Node.js."),(0,i.kt)("li",{parentName:"ul"},"Khi call stack tr\u1ed1ng, c\xe1c t\xe1c v\u1ee5 trong microtask queue \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n tr\u01b0\u1edbc.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Macro Task Queue (Task Queue)"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"C\xe1c nhi\u1ec7m v\u1ee5 macro task ch\u1eadm h\u01a1n v\xe0 \xedt \u01b0u ti\xean h\u01a1n so v\u1edbi c\xe1c t\xe1c v\u1ee5 microtask."),(0,i.kt)("li",{parentName:"ul"},"C\xe1c t\xe1c v\u1ee5 macro task bao g\u1ed3m c\xe1c t\xe1c v\u1ee5 nh\u01b0 setTimeout, setInterval, requestAnimationFrame, DOM events, fetch, v\xe0 c\xe1c t\xe1c v\u1ee5 g\u1eedi m\u1ea1ng."),(0,i.kt)("li",{parentName:"ul"},"C\xe1c t\xe1c v\u1ee5 trong macro task queue ch\u1ec9 \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n khi call stack ho\xe0n to\xe0n tr\u1ed1ng v\xe0 kh\xf4ng c\xf2n t\xe1c v\u1ee5 n\xe0o trong microtask queue.")),(0,i.kt)("h2",{id:"processnexttick-and-setimmediate-in-event-loop"},"process.nextTick() and setImmediate() in Event Loop"),(0,i.kt)("p",null,"Trong Node.js, c\u1ea3 process.nextTick() v\xe0 setImmediate() \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng \u0111\u1ec3 l\xean l\u1ecbch th\u1ef1c thi m\u1ed9t h\xe0m callback sau khi giai \u0111o\u1ea1n hi\u1ec7n t\u1ea1i c\u1ee7a v\xf2ng l\u1eb7p s\u1ef1 ki\u1ec7n ho\xe0n th\xe0nh. Tuy nhi\xean, ch\xfang ho\u1ea1t \u0111\u1ed9ng trong c\xe1c ph\u1ea7n kh\xe1c nhau c\u1ee7a v\xf2ng l\u1eb7p."),(0,i.kt)("h3",{id:"processnexttick"},"process.nextTick()"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Description"),": L\xean l\u1ecbch m\u1ed9t h\xe0m callback \u0111\u01b0\u1ee3c g\u1ecdi sau khi giai \u0111o\u1ea1n hi\u1ec7n t\u1ea1i c\u1ee7a v\xf2ng l\u1eb7p s\u1ef1 ki\u1ec7n ho\xe0n th\xe0nh v\xe0 tr\u01b0\u1edbc b\u1ea5t k\u1ef3 ho\u1ea1t \u0111\u1ed9ng I/O n\xe0o di\u1ec5n ra."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Operation"),': H\xe0m callback \u0111\u01b0\u1ee3c th\xeam v\xe0o m\u1ed9t h\xe0ng \u0111\u1ee3i \u0111\u1eb7c bi\u1ec7t \u0111\u01b0\u1ee3c g\u1ecdi l\xe0 "nextTick queue," v\xe0 s\u1ebd \u0111\u01b0\u1ee3c th\u1ef1c thi sau m\u1ed7i giai \u0111o\u1ea1n c\u1ee7a v\xf2ng l\u1eb7p s\u1ef1 ki\u1ec7n. \u0110i\u1ec1u n\xe0y c\xf3 ngh\u0129a l\xe0 n\u1ebfu b\u1ea1n ti\u1ebfp t\u1ee5c th\xeam c\xe1c h\xe0m v\xe0o h\xe0ng \u0111\u1ee3i "nextTick," v\xf2ng l\u1eb7p s\u1ef1 ki\u1ec7n c\xf3 th\u1ec3 b\u1ecb m\u1eafc k\u1eb9t trong giai \u0111o\u1ea1n hi\u1ec7n t\u1ea1i, v\xe0 c\xe1c ho\u1ea1t \u0111\u1ed9ng kh\xe1c (nh\u01b0 I/O) c\xf3 th\u1ec3 b\u1ecb tr\xec ho\xe3n.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'console.log("Start");\n\nprocess.nextTick(() => {\n  console.log("Next Tick");\n});\n\nconsole.log("End");\n')),(0,i.kt)("p",null,"Output"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"Start\nEnd\nNext Tick\n")),(0,i.kt)("h3",{id:"setimmediate"},"setImmediate()"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Description"),': L\xean l\u1ecbch m\u1ed9t h\xe0m callback \u0111\u1ec3 th\u1ef1c thi trong giai \u0111o\u1ea1n "check" c\u1ee7a v\xf2ng l\u1eb7p s\u1ef1 ki\u1ec7n sau khi c\xe1c s\u1ef1 ki\u1ec7n I/O \u0111\u01b0\u1ee3c x\u1eed l\xfd.'),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Operation"),": H\xe0m callback \u0111\u01b0\u1ee3c th\xeam v\xe0o m\u1ed9t h\xe0ng \u0111\u1ee3i ri\xeang v\xe0 s\u1ebd \u0111\u01b0\u1ee3c th\u1ef1c thi sau khi t\u1ea5t c\u1ea3 c\xe1c s\u1ef1 ki\u1ec7n I/O \u0111\u01b0\u1ee3c x\u1eed l\xfd."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'console.log("Start");\n\nsetImmediate(() => {\n  console.log("Immediate");\n});\n\nconsole.log("End");\n')),(0,i.kt)("p",null,"Output"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"Start;\nEnd;\nImmediate;\n")),(0,i.kt)("p",null,"Tuy nhi\xean, th\u1ee9 t\u1ef1 gi\u1eefa Next Tick v\xe0 Immediate kh\xf4ng \u0111\u01b0\u1ee3c \u0111\u1ea3m b\u1ea3o trong m\u1ecdi t\xecnh hu\u1ed1ng, \u0111\u1eb7c bi\u1ec7t khi ch\xfang \u0111\u01b0\u1ee3c g\u1ecdi t\u1eeb m\u1ed9t chu k\u1ef3 I/O. Nh\u01b0ng n\u1ebfu ch\u1ea1y trong ng\u1eef c\u1ea3nh kh\xf4ng c\xf3 I/O, process.nextTick() lu\xf4n lu\xf4n \u0111\u01b0\u1ee3c th\u1ef1c thi tr\u01b0\u1edbc setImmediate()."),(0,i.kt)("p",null,"Trong th\u1ef1c t\u1ebf, khi b\u1ea1n c\u1ea7n l\xean l\u1ecbch m\u1ed9t h\xe0m ch\u1ea1y sau khi ng\u0103n x\u1ebfp hi\u1ec7n t\u1ea1i ho\xe0n th\xe0nh nh\u01b0ng tr\u01b0\u1edbc b\u1ea5t k\u1ef3 ho\u1ea1t \u0111\u1ed9ng I/O n\xe0o, h\xe3y s\u1eed d\u1ee5ng process.nextTick(). Khi b\u1ea1n mu\u1ed1n l\xean l\u1ecbch m\u1ed9t h\xe0m ch\u1ea1y sau t\u1ea5t c\u1ea3 c\xe1c ho\u1ea1t \u0111\u1ed9ng I/O, h\xe3y s\u1eed d\u1ee5ng setImmediate()."))}m.isMDXComponent=!0}}]);