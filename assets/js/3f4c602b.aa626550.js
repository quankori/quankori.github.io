"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3],{3905:(t,n,e)=>{e.d(n,{Zo:()=>p,kt:()=>m});var i=e(7294);function a(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function c(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}function r(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?c(Object(e),!0).forEach((function(n){a(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):c(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function h(t,n){if(null==t)return{};var e,i,a=function(t,n){if(null==t)return{};var e,i,a={},c=Object.keys(t);for(i=0;i<c.length;i++)e=c[i],n.indexOf(e)>=0||(a[e]=t[e]);return a}(t,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(i=0;i<c.length;i++)e=c[i],n.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(a[e]=t[e])}return a}var l=i.createContext({}),o=function(t){var n=i.useContext(l),e=n;return t&&(e="function"==typeof t?t(n):r(r({},n),t)),e},p=function(t){var n=o(t.components);return i.createElement(l.Provider,{value:n},t.children)},g="mdxType",u={inlineCode:"code",wrapper:function(t){var n=t.children;return i.createElement(i.Fragment,{},n)}},s=i.forwardRef((function(t,n){var e=t.components,a=t.mdxType,c=t.originalType,l=t.parentName,p=h(t,["components","mdxType","originalType","parentName"]),g=o(e),s=a,m=g["".concat(l,".").concat(s)]||g[s]||u[s]||c;return e?i.createElement(m,r(r({ref:n},p),{},{components:e})):i.createElement(m,r({ref:n},p))}));function m(t,n){var e=arguments,a=n&&n.mdxType;if("string"==typeof t||a){var c=e.length,r=new Array(c);r[0]=s;var h={};for(var l in n)hasOwnProperty.call(n,l)&&(h[l]=n[l]);h.originalType=t,h[g]="string"==typeof t?t:a,r[1]=h;for(var o=2;o<c;o++)r[o]=e[o];return i.createElement.apply(null,r)}return i.createElement.apply(null,e)}s.displayName="MDXCreateElement"},4512:(t,n,e)=>{e.r(n),e.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>c,metadata:()=>h,toc:()=>o});var i=e(7462),a=(e(7294),e(3905));const c={title:"System Design Pattern"},r=void 0,h={unversionedId:"blog/system-design/system-design-pattern",id:"blog/system-design/system-design-pattern",title:"System Design Pattern",description:"SAGA Pattern: Qu\u1ea3n l\xfd Transaction Ph\xe2n t\xe1n",source:"@site/docs/blog/system-design/system-design-pattern.md",sourceDirName:"blog/system-design",slug:"/blog/system-design/system-design-pattern",permalink:"/blog/system-design/system-design-pattern",draft:!1,tags:[],version:"current",frontMatter:{title:"System Design Pattern"},sidebar:"blog",previous:{title:"Serverless Architecture",permalink:"/blog/system-design/serverless"},next:{title:"Database",permalink:"/blog/system-design/database"}},l={},o=[{value:"SAGA Pattern: Qu\u1ea3n l\xfd Transaction Ph\xe2n t\xe1n",id:"saga-pattern-qu\u1ea3n-l\xfd-transaction-ph\xe2n-t\xe1n",level:2},{value:"Choreography (\u0110i\u1ec1u ph\u1ed1i Phi t\u1eadp trung)",id:"choreography-\u0111i\u1ec1u-ph\u1ed1i-phi-t\u1eadp-trung",level:3},{value:"Orchestration (\u0110i\u1ec1u ph\u1ed1i T\u1eadp trung)",id:"orchestration-\u0111i\u1ec1u-ph\u1ed1i-t\u1eadp-trung",level:3},{value:"CQRS (Command Query Responsibility Segregation)",id:"cqrs-command-query-responsibility-segregation",level:2},{value:"Backends for Frontend (BFF): T\u1ed1i \u01b0u Giao di\u1ec7n Ng\u01b0\u1eddi d\xf9ng",id:"backends-for-frontend-bff-t\u1ed1i-\u01b0u-giao-di\u1ec7n-ng\u01b0\u1eddi-d\xf9ng",level:2},{value:"Transactional Outbox v\xe0 Inbox Pattern: \u0110\u1ea3m b\u1ea3o Tin c\u1eady trong Giao ti\u1ebfp B\u1ea5t \u0111\u1ed3ng b\u1ed9",id:"transactional-outbox-v\xe0-inbox-pattern-\u0111\u1ea3m-b\u1ea3o-tin-c\u1eady-trong-giao-ti\u1ebfp-b\u1ea5t-\u0111\u1ed3ng-b\u1ed9",level:2},{value:"Transactional Outbox",id:"transactional-outbox",level:3},{value:"Transactional Inbox",id:"transactional-inbox",level:3},{value:"Fan-out/Fan-in Pattern: X\u1eed l\xfd Song song v\xe0 T\u1ed5ng h\u1ee3p K\u1ebft qu\u1ea3",id:"fan-outfan-in-pattern-x\u1eed-l\xfd-song-song-v\xe0-t\u1ed5ng-h\u1ee3p-k\u1ebft-qu\u1ea3",level:2},{value:"Shared Database Anti-Pattern: C\u1ea1m b\u1eaby C\u1ea7n Tr\xe1nh",id:"shared-database-anti-pattern-c\u1ea1m-b\u1eaby-c\u1ea7n-tr\xe1nh",level:2}],p={toc:o},g="wrapper";function u(t){let{components:n,...e}=t;return(0,a.kt)(g,(0,i.Z)({},p,e,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"saga-pattern-qu\u1ea3n-l\xfd-transaction-ph\xe2n-t\xe1n"},"SAGA Pattern: Qu\u1ea3n l\xfd Transaction Ph\xe2n t\xe1n"),(0,a.kt)("p",null,"Trong ki\u1ebfn tr\xfac microservices, m\u1ed9t nghi\u1ec7p v\u1ee5 kinh doanh (business transaction) th\u01b0\u1eddng ph\u1ea3i tr\u1ea3i qua nhi\u1ec1u service kh\xe1c nhau. Vi\u1ec7c duy tr\xec t\xednh nh\u1ea5t qu\xe1n d\u1eef li\u1ec7u (consistency) tr\u1edf n\xean ph\u1ee9c t\u1ea1p v\xec ch\xfang ta kh\xf4ng th\u1ec3 s\u1eed d\u1ee5ng c\xe1c transaction ACID truy\u1ec1n th\u1ed1ng k\xe9o d\xe0i qua nhi\u1ec1u database \u0111\u1ed9c l\u1eadp. SAGA pattern ra \u0111\u1eddi \u0111\u1ec3 gi\u1ea3i quy\u1ebft v\u1ea5n \u0111\u1ec1 n\xe0y."),(0,a.kt)("p",null,"M\u1ed9t SAGA l\xe0 m\u1ed9t chu\u1ed7i c\xe1c local transaction. M\u1ed7i local transaction trong SAGA s\u1ebd c\u1eadp nh\u1eadt d\u1eef li\u1ec7u trong m\u1ed9t service c\u1ee5 th\u1ec3 v\xe0 ph\xe1t ra m\u1ed9t message ho\u1eb7c event \u0111\u1ec3 k\xedch ho\u1ea1t local transaction ti\u1ebfp theo trong service kh\xe1c. N\u1ebfu m\u1ed9t local transaction th\u1ea5t b\u1ea1i, SAGA s\u1ebd th\u1ef1c thi c\xe1c compensating transaction \u0111\u1ec3 ho\xe0n t\xe1c (undo) c\xe1c thay \u0111\u1ed5i \u0111\xe3 \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n b\u1edfi c\xe1c local transaction tr\u01b0\u1edbc \u0111\xf3, \u0111\u1ea3m b\u1ea3o t\xednh nh\u1ea5t qu\xe1n cu\u1ed1i c\xf9ng (eventual consistency)."),(0,a.kt)("p",null,"C\xf3 hai c\xe1ch ch\xednh \u0111\u1ec3 \u0111i\u1ec1u ph\u1ed1i SAGA:"),(0,a.kt)("h3",{id:"choreography-\u0111i\u1ec1u-ph\u1ed1i-phi-t\u1eadp-trung"},"Choreography (\u0110i\u1ec1u ph\u1ed1i Phi t\u1eadp trung)"),(0,a.kt)("p",null,"M\u1ed7i service t\u1ef1 bi\u1ebft ph\u1ea3i l\xe0m g\xec ti\u1ebfp theo d\u1ef1a tr\xean c\xe1c event nh\u1eadn \u0111\u01b0\u1ee3c t\u1eeb c\xe1c service kh\xe1c. Kh\xf4ng c\xf3 m\u1ed9t b\u1ed9 \u0111i\u1ec1u ph\u1ed1i trung t\xe2m."),(0,a.kt)("p",null,"Service A ho\xe0n th\xe0nh local transaction, publish m\u1ed9t event (v\xed d\u1ee5: OrderCreated). Service B l\u1eafng nghe event n\xe0y, th\u1ef1c hi\u1ec7n local transaction c\u1ee7a m\xecnh v\xe0 publish event ti\u1ebfp theo (v\xed d\u1ee5: PaymentProcessed). Service C l\u1eafng nghe event c\u1ee7a B, v.v. N\u1ebfu Service B th\u1ea5t b\u1ea1i, n\xf3 s\u1ebd publish m\u1ed9t event l\u1ed7i (v\xed d\u1ee5: PaymentFailed), v\xe0 Service A (ho\u1eb7c m\u1ed9t service kh\xe1c) s\u1ebd l\u1eafng nghe event n\xe0y \u0111\u1ec3 th\u1ef1c thi compensating transaction (v\xed d\u1ee5: h\u1ee7y \u0111\u01a1n h\xe0ng)."),(0,a.kt)("p",null,"\u01afu \u0111i\u1ec3m:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u0110\u01a1n gi\u1ea3n, d\u1ec5 hi\u1ec3u cho c\xe1c SAGA ng\u1eafn.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Kh\xf4ng c\xf3 \u0111i\u1ec3m l\u1ed7i trung t\xe2m (single point of failure) trong vi\u1ec7c \u0111i\u1ec1u ph\u1ed1i.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"C\xe1c service \xedt ph\u1ee5 thu\u1ed9c (loosely coupled)."))),(0,a.kt)("p",null,"Nh\u01b0\u1ee3c \u0111i\u1ec3m:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Kh\xf3 theo d\xf5i lu\u1ed3ng nghi\u1ec7p v\u1ee5 khi SAGA c\xf3 nhi\u1ec1u b\u01b0\u1edbc.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"D\u1ec5 x\u1ea3y ra ph\u1ee5 thu\u1ed9c v\xf2ng (cyclic dependencies) gi\u1eefa c\xe1c service n\u1ebfu kh\xf4ng c\u1ea9n th\u1eadn.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Vi\u1ec7c debug v\xe0 ki\u1ec3m th\u1eed tr\u1edf n\xean ph\u1ee9c t\u1ea1p."))),(0,a.kt)("h3",{id:"orchestration-\u0111i\u1ec1u-ph\u1ed1i-t\u1eadp-trung"},"Orchestration (\u0110i\u1ec1u ph\u1ed1i T\u1eadp trung)"),(0,a.kt)("p",null,"C\xf3 m\u1ed9t service \u0111i\u1ec1u ph\u1ed1i trung t\xe2m (Orchestrator) ch\u1ecbu tr\xe1ch nhi\u1ec7m ch\u1ec9 \u0111\u1ea1o lu\u1ed3ng SAGA. Orchestrator g\u1eedi c\xe1c command \u0111\u1ebfn t\u1eebng service \u0111\u1ec3 y\xeau c\u1ea7u th\u1ef1c hi\u1ec7n local transaction v\xe0 nh\u1eadn l\u1ea1i k\u1ebft qu\u1ea3 (ho\u1eb7c event)."),(0,a.kt)("p",null,"Client g\u1eedi request t\u1ea1o \u0111\u01a1n h\xe0ng \u0111\u1ebfn Orchestrator. Orchestrator g\u1eedi command CreateOrder \u0111\u1ebfn Order Service. Order Service th\u1ef1c hi\u1ec7n xong, tr\u1ea3 k\u1ebft qu\u1ea3 v\u1ec1 Orchestrator. Orchestrator g\u1eedi command ProcessPayment \u0111\u1ebfn Payment Service. N\u1ebfu Payment Service th\xe0nh c\xf4ng, Orchestrator g\u1eedi command ShipOrder \u0111\u1ebfn Shipping Service. N\u1ebfu Payment Service th\u1ea5t b\u1ea1i, Orchestrator s\u1ebd g\u1eedi command CancelOrder (compensating transaction) \u0111\u1ebfn Order Service."),(0,a.kt)("p",null,"\u01afu \u0111i\u1ec3m:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Lu\u1ed3ng nghi\u1ec7p v\u1ee5 \u0111\u01b0\u1ee3c qu\u1ea3n l\xfd t\u1eadp trung, d\u1ec5 hi\u1ec3u v\xe0 theo d\xf5i.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"D\u1ec5 d\xe0ng qu\u1ea3n l\xfd c\xe1c ph\u1ee5 thu\u1ed9c v\xe0 logic ph\u1ee9c t\u1ea1p.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\xcdt kh\u1ea3 n\u0103ng x\u1ea3y ra ph\u1ee5 thu\u1ed9c v\xf2ng."))),(0,a.kt)("p",null,"Nh\u01b0\u1ee3c \u0111i\u1ec3m:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Orchestrator c\xf3 th\u1ec3 tr\u1edf th\xe0nh \u0111i\u1ec3m l\u1ed7i trung t\xe2m.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Logic nghi\u1ec7p v\u1ee5 t\u1eadp trung qu\xe1 nhi\u1ec1u v\xe0o Orchestrator.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"C\xe1c service tham gia SAGA ph\u1ee5 thu\u1ed9c v\xe0o Orchestrator."))),(0,a.kt)("h2",{id:"cqrs-command-query-responsibility-segregation"},"CQRS (Command Query Responsibility Segregation)"),(0,a.kt)("p",null,"L\xe0 m\u1ed9t m\u1eabu (pattern) t\xe1ch bi\u1ec7t ho\xe0n to\xe0n tr\xe1ch nhi\u1ec7m gi\u1eefa vi\u1ec7c thay \u0111\u1ed5i tr\u1ea1ng th\xe1i h\u1ec7 th\u1ed1ng (th\xf4ng qua c\xe1c Commands) v\xe0 vi\u1ec7c truy v\u1ea5n tr\u1ea1ng th\xe1i h\u1ec7 th\u1ed1ng (th\xf4ng qua c\xe1c Queries)"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Commands"),": \u0110\u1ea1i di\u1ec7n cho \xfd \u0111\u1ecbnh thay \u0111\u1ed5i tr\u1ea1ng th\xe1i (v\xed d\u1ee5: CreateUserCommand, UpdateProductPriceCommand). Ch\xfang th\u01b0\u1eddng kh\xf4ng tr\u1ea3 v\u1ec1 d\u1eef li\u1ec7u m\xe0 ch\u1ec9 b\xe1o th\xe0nh c\xf4ng/th\u1ea5t b\u1ea1i. Logic x\u1eed l\xfd command c\xf3 th\u1ec3 ph\u1ee9c t\u1ea1p."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Queries"),": \u0110\u1ea1i di\u1ec7n cho y\xeau c\u1ea7u l\u1ea5y d\u1eef li\u1ec7u (v\xed d\u1ee5: GetUserByIdQuery, GetProductsByCategoryQuery). Ch\xfang ch\u1ec9 \u0111\u1ecdc d\u1eef li\u1ec7u v\xe0 kh\xf4ng l\xe0m thay \u0111\u1ed5i tr\u1ea1ng th\xe1i. Logic x\u1eed l\xfd query th\u01b0\u1eddng \u0111\u01a1n gi\u1ea3n h\u01a1n."),(0,a.kt)("p",null,"M\xf4 h\xecnh d\u1eef li\u1ec7u ri\xeang bi\u1ec7t (Optional but common): Th\u01b0\u1eddng \u0111i k\xe8m v\u1edbi vi\u1ec7c s\u1eed d\u1ee5ng c\xe1c m\xf4 h\xecnh d\u1eef li\u1ec7u (data models) kh\xe1c nhau cho vi\u1ec7c ghi (write model - t\u1ed1i \u01b0u cho vi\u1ec7c ghi v\xe0 \u0111\u1ea3m b\u1ea3o t\xednh nh\u1ea5t qu\xe1n) v\xe0 vi\u1ec7c \u0111\u1ecdc (read model(s) - t\u1ed1i \u01b0u cho vi\u1ec7c truy v\u1ea5n nhanh, c\xf3 th\u1ec3 l\xe0 c\xe1c view \u0111\u01b0\u1ee3c chu\u1ea9n b\u1ecb s\u1eb5n, denormalized). D\u1eef li\u1ec7u t\u1eeb write model th\u01b0\u1eddng \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt sang read model(s) m\u1ed9t c\xe1ch b\u1ea5t \u0111\u1ed3ng b\u1ed9 (v\xed d\u1ee5: th\xf4ng qua events)."),(0,a.kt)("p",null,"L\u1ee3i \xedch: T\u1ed1i \u01b0u h\xf3a \u0111\u1ed9c l\u1eadp cho vi\u1ec7c \u0111\u1ecdc v\xe0 ghi, c\u1ea3i thi\u1ec7n hi\u1ec7u n\u0103ng, kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng (c\xf3 th\u1ec3 scale ri\xeang ph\u1ea7n \u0111\u1ecdc v\xe0 ph\u1ea7n ghi), \u0111\u01a1n gi\u1ea3n h\xf3a c\xe1c m\xf4 h\xecnh d\u1eef li\u1ec7u ph\u1ee9c t\u1ea1p."),(0,a.kt)("h2",{id:"backends-for-frontend-bff-t\u1ed1i-\u01b0u-giao-di\u1ec7n-ng\u01b0\u1eddi-d\xf9ng"},"Backends for Frontend (BFF): T\u1ed1i \u01b0u Giao di\u1ec7n Ng\u01b0\u1eddi d\xf9ng"),(0,a.kt)("p",null,"BFF l\xe0 m\u1ed9t pattern ki\u1ebfn tr\xfac n\u01a1i b\u1ea1n t\u1ea1o ra c\xe1c backend API ri\xeang bi\u1ec7t, \u0111\u01b0\u1ee3c t\u1ed1i \u01b0u h\xf3a cho t\u1eebng lo\u1ea1i giao di\u1ec7n ng\u01b0\u1eddi d\xf9ng (frontend client) c\u1ee5 th\u1ec3 (v\xed d\u1ee5: web app, mobile app, desktop app). Thay v\xec m\u1ed9t API gateway chung chung, m\u1ed7i client type s\u1ebd c\xf3 m\u1ed9t BFF ri\xeang."),(0,a.kt)("p",null,"C\xe1c lo\u1ea1i client kh\xe1c nhau th\u01b0\u1eddng c\xf3 nhu c\u1ea7u d\u1eef li\u1ec7u v\xe0 \u0111\u1ecbnh d\u1ea1ng kh\xe1c nhau. M\u1ed9t API chung c\xf3 th\u1ec3 tr\u1ea3 v\u1ec1 qu\xe1 nhi\u1ec1u ho\u1eb7c qu\xe1 \xedt d\u1eef li\u1ec7u, ho\u1eb7c \u0111\u1ecbnh d\u1ea1ng kh\xf4ng ph\xf9 h\u1ee3p, bu\u1ed9c client ph\u1ea3i x\u1eed l\xfd th\xeam logic. BFF gi\xfap \u0111\u01a1n gi\u1ea3n h\xf3a ph\xeda client."),(0,a.kt)("p",null,"BFF \u0111\xf3ng vai tr\xf2 nh\u01b0 m\u1ed9t l\u1edbp trung gian gi\u1eefa client v\xe0 c\xe1c microservices h\u1ea1 ngu\u1ed3n (downstream). N\xf3 nh\u1eadn request t\u1eeb client, g\u1ecdi \u0111\u1ebfn m\u1ed9t ho\u1eb7c nhi\u1ec1u microservices c\u1ea7n thi\u1ebft, t\u1ed5ng h\u1ee3p, bi\u1ebfn \u0111\u1ed5i d\u1eef li\u1ec7u v\xe0 tr\u1ea3 v\u1ec1 k\u1ebft qu\u1ea3 theo \u0111\xfang \u0111\u1ecbnh d\u1ea1ng m\xe0 client \u0111\xf3 mong mu\u1ed1n."),(0,a.kt)("p",null,"\u01afu \u0111i\u1ec3m:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"T\u1ed1i \u01b0u h\xf3a tr\u1ea3i nghi\u1ec7m cho t\u1eebng lo\u1ea1i client.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Gi\u1ea3m logic x\u1eed l\xfd \u1edf ph\xeda client.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Cho ph\xe9p c\xe1c team frontend ph\xe1t tri\u1ec3n \u0111\u1ed9c l\u1eadp h\u01a1n v\u1edbi c\xe1c backend service chung.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"C\u1ea3i thi\u1ec7n b\u1ea3o m\u1eadt b\u1eb1ng c\xe1ch ch\u1ec9 expose nh\u1eefng g\xec c\u1ea7n thi\u1ebft cho t\u1eebng client."))),(0,a.kt)("p",null,"Nh\u01b0\u1ee3c \u0111i\u1ec3m:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"T\u0103ng s\u1ed1 l\u01b0\u1ee3ng backend c\u1ea7n ph\xe1t tri\u1ec3n v\xe0 qu\u1ea3n l\xfd.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"C\xf3 th\u1ec3 d\u1eabn \u0111\u1ebfn tr\xf9ng l\u1eb7p code gi\u1eefa c\xe1c BFF n\u1ebfu kh\xf4ng qu\u1ea3n l\xfd t\u1ed1t.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"T\u0103ng th\xeam m\u1ed9t l\u1edbp m\u1ea1ng (network hop)."))),(0,a.kt)("h2",{id:"transactional-outbox-v\xe0-inbox-pattern-\u0111\u1ea3m-b\u1ea3o-tin-c\u1eady-trong-giao-ti\u1ebfp-b\u1ea5t-\u0111\u1ed3ng-b\u1ed9"},"Transactional Outbox v\xe0 Inbox Pattern: \u0110\u1ea3m b\u1ea3o Tin c\u1eady trong Giao ti\u1ebfp B\u1ea5t \u0111\u1ed3ng b\u1ed9"),(0,a.kt)("p",null,"Khi m\u1ed9t service c\u1ea7n c\u1eadp nh\u1eadt database c\u1ee7a m\xecnh V\xc0 g\u1eedi m\u1ed9t message/event \u0111\u1ebfn m\u1ed9t service kh\xe1c (v\xed d\u1ee5: th\xf4ng qua message queue nh\u01b0 Kafka, RabbitMQ), l\xe0m th\u1ebf n\xe0o \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o c\u1ea3 hai h\xe0nh \u0111\u1ed9ng n\xe0y x\u1ea3y ra m\u1ed9t c\xe1ch nguy\xean t\u1eed (atomic)? N\u1ebfu c\u1eadp nh\u1eadt DB th\xe0nh c\xf4ng nh\u01b0ng g\u1eedi message th\u1ea5t b\u1ea1i (ho\u1eb7c ng\u01b0\u1ee3c l\u1ea1i), h\u1ec7 th\u1ed1ng s\u1ebd r\u01a1i v\xe0o tr\u1ea1ng th\xe1i kh\xf4ng nh\u1ea5t qu\xe1n."),(0,a.kt)("h3",{id:"transactional-outbox"},"Transactional Outbox"),(0,a.kt)("p",null,'Thay v\xec tr\u1ef1c ti\u1ebfp g\u1eedi message sau khi c\u1eadp nh\u1eadt DB, service s\u1ebd ghi message \u0111\xf3 v\xe0o m\u1ed9t b\u1ea3ng \u0111\u1eb7c bi\u1ec7t trong c\xf9ng database g\u1ecdi l\xe0 "outbox table", trong c\xf9ng m\u1ed9t local transaction v\u1edbi vi\u1ec7c c\u1eadp nh\u1eadt d\u1eef li\u1ec7u nghi\u1ec7p v\u1ee5.'),(0,a.kt)("p",null,"Workflow:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"B\u1eaft \u0111\u1ea7u m\u1ed9t local database transaction.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"C\u1eadp nh\u1eadt b\u1ea3ng d\u1eef li\u1ec7u nghi\u1ec7p v\u1ee5 (v\xed d\u1ee5: Orders).")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Ch\xe8n m\u1ed9t record m\xf4 t\u1ea3 message/event v\xe0o b\u1ea3ng Outbox (ch\u1ee9a th\xf4ng tin nh\u01b0 \u0111\xedch \u0111\u1ebfn, payload,...).")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Commit database transaction.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"M\u1ed9t ti\u1ebfn tr\xecnh ri\xeang bi\u1ec7t (message relay/event publisher) s\u1ebd theo d\xf5i b\u1ea3ng Outbox, \u0111\u1ecdc c\xe1c message ch\u01b0a g\u1eedi v\xe0 publish ch\xfang l\xean message broker. Sau khi publish th\xe0nh c\xf4ng, message trong b\u1ea3ng Outbox s\u1ebd \u0111\u01b0\u1ee3c \u0111\xe1nh d\u1ea5u l\xe0 \u0111\xe3 g\u1eedi ho\u1eb7c x\xf3a \u0111i."))),(0,a.kt)("p",null,"V\xec c\u1ea3 vi\u1ec7c c\u1eadp nh\u1eadt d\u1eef li\u1ec7u nghi\u1ec7p v\u1ee5 v\xe0 ghi v\xe0o outbox \u0111\u1ec1u n\u1eb1m trong c\xf9ng m\u1ed9t DB transaction, ch\xfang s\u1ebd ho\u1eb7c c\xf9ng th\xe0nh c\xf4ng ho\u1eb7c c\xf9ng th\u1ea5t b\u1ea1i (atomicity). Ti\u1ebfn tr\xecnh relay \u0111\u1ea3m b\u1ea3o message cu\u1ed1i c\xf9ng s\u1ebd \u0111\u01b0\u1ee3c g\u1eedi \u0111i (at-least-once delivery)."),(0,a.kt)("h3",{id:"transactional-inbox"},"Transactional Inbox"),(0,a.kt)("p",null,"L\xe0 pattern ph\xeda service nh\u1eadn message, \u0111\u1ea3m b\u1ea3o vi\u1ec7c x\u1eed l\xfd message v\xe0 c\u1eadp nh\u1eadt tr\u1ea1ng th\xe1i l\xe0 idempotent (th\u1ef1c hi\u1ec7n nhi\u1ec1u l\u1ea7n kh\xf4ng thay \u0111\u1ed5i k\u1ebft qu\u1ea3 sau l\u1ea7n \u0111\u1ea7u th\xe0nh c\xf4ng) v\xe0 \u0111\xe1ng tin c\u1eady."),(0,a.kt)("p",null,"Workflow:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Service nh\u1eadn (consumer) \u0111\u1ecdc message t\u1eeb message broker.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Ghi th\xf4ng tin message (v\xed d\u1ee5: message ID) v\xe0o m\u1ed9t b\u1ea3ng Inbox trong database c\u1ee7a m\xecnh. Ki\u1ec3m tra xem message ID n\xe0y \u0111\xe3 \u0111\u01b0\u1ee3c x\u1eed l\xfd ch\u01b0a. N\u1ebfu \u0111\xe3 x\u1eed l\xfd, b\u1ecf qua message (\u0111\u1ea3m b\u1ea3o idempotency).")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"N\u1ebfu ch\u01b0a x\u1eed l\xfd:"))),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"B\u1eaft \u0111\u1ea7u m\u1ed9t local database transaction.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"X\u1eed l\xfd message (v\xed d\u1ee5: c\u1eadp nh\u1eadt d\u1eef li\u1ec7u nghi\u1ec7p v\u1ee5).")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u0110\xe1nh d\u1ea5u message trong b\u1ea3ng Inbox l\xe0 \u0111\xe3 x\u1eed l\xfd.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Commit database transaction."))),(0,a.kt)("p",null,"Ng\u0103n ch\u1eb7n vi\u1ec7c x\u1eed l\xfd tr\xf9ng l\u1eb7p message trong tr\u01b0\u1eddng h\u1ee3p message \u0111\u01b0\u1ee3c g\u1eedi l\u1ea1i (at-least-once delivery t\u1eeb broker)."),(0,a.kt)("h2",{id:"fan-outfan-in-pattern-x\u1eed-l\xfd-song-song-v\xe0-t\u1ed5ng-h\u1ee3p-k\u1ebft-qu\u1ea3"},"Fan-out/Fan-in Pattern: X\u1eed l\xfd Song song v\xe0 T\u1ed5ng h\u1ee3p K\u1ebft qu\u1ea3"),(0,a.kt)("p",null,"\u0110\xe2y l\xe0 m\u1ed9t pattern lu\u1ed3ng c\xf4ng vi\u1ec7c (workflow pattern) th\u01b0\u1eddng \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng \u0111\u1ec3 t\u0103ng t\u1ed1c \u0111\u1ed9 x\u1eed l\xfd b\u1eb1ng c\xe1ch chia m\u1ed9t t\xe1c v\u1ee5 l\u1edbn th\xe0nh nhi\u1ec1u t\xe1c v\u1ee5 nh\u1ecf h\u01a1n ch\u1ea1y song song (Fan-out) v\xe0 sau \u0111\xf3 t\u1ed5ng h\u1ee3p k\u1ebft qu\u1ea3 t\u1eeb c\xe1c t\xe1c v\u1ee5 con \u0111\xf3 (Fan-in)."),(0,a.kt)("p",null,"Ho\u1ea1t \u0111\u1ed9ng:"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Fan-out"),": M\u1ed9t th\xe0nh ph\u1ea7n \u0111i\u1ec1u ph\u1ed1i (dispatcher/orchestrator) nh\u1eadn m\u1ed9t y\xeau c\u1ea7u ho\u1eb7c m\u1ed9t t\u1eadp d\u1eef li\u1ec7u l\u1edbn. N\xf3 chia nh\u1ecf c\xf4ng vi\u1ec7c ho\u1eb7c d\u1eef li\u1ec7u th\xe0nh nhi\u1ec1u ph\u1ea7n v\xe0 g\u1eedi t\u1eebng ph\u1ea7n \u0111\u1ebfn c\xe1c worker kh\xe1c nhau \u0111\u1ec3 x\u1eed l\xfd \u0111\u1ed3ng th\u1eddi/song song. V\xed d\u1ee5: g\u1eedi c\xe1c ID s\u1ea3n ph\u1ea9m c\u1ea7n c\u1eadp nh\u1eadt gi\xe1 \u0111\u1ebfn nhi\u1ec1u instance c\u1ee7a Price Update Service."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Fan-in"),": Sau khi c\xe1c worker ho\xe0n th\xe0nh x\u1eed l\xfd ph\u1ea7n vi\u1ec7c c\u1ee7a m\xecnh, ch\xfang g\u1eedi k\u1ebft qu\u1ea3 tr\u1edf l\u1ea1i. M\u1ed9t th\xe0nh ph\u1ea7n t\u1ed5ng h\u1ee3p (aggregator/collector) s\u1ebd \u0111\u1ee3i nh\u1eadn \u0111\u1ee7 k\u1ebft qu\u1ea3 t\u1eeb c\xe1c worker (ho\u1eb7c \u0111\u1ebfn m\u1ed9t ng\u01b0\u1ee1ng n\xe0o \u0111\xf3/timeout) v\xe0 t\u1ed5ng h\u1ee3p ch\xfang th\xe0nh k\u1ebft qu\u1ea3 cu\u1ed1i c\xf9ng. V\xed d\u1ee5: nh\u1eadn c\xe1c tr\u1ea1ng th\xe1i c\u1eadp nh\u1eadt gi\xe1 t\u1eeb c\xe1c worker v\xe0 b\xe1o c\xe1o k\u1ebft qu\u1ea3 t\u1ed5ng th\u1ec3."),(0,a.kt)("p",null,"\u01afu \u0111i\u1ec3m:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"T\u0103ng \u0111\xe1ng k\u1ec3 t\u1ed1c \u0111\u1ed9 x\u1eed l\xfd cho c\xe1c t\xe1c v\u1ee5 c\xf3 th\u1ec3 chia nh\u1ecf v\xe0 song song h\xf3a.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"C\u1ea3i thi\u1ec7n kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng b\u1eb1ng c\xe1ch th\xeam nhi\u1ec1u worker h\u01a1n."))),(0,a.kt)("p",null,"Nh\u01b0\u1ee3c \u0111i\u1ec3m:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Ph\u1ee9c t\u1ea1p trong vi\u1ec7c qu\u1ea3n l\xfd lu\u1ed3ng c\xf4ng vi\u1ec7c, x\u1eed l\xfd l\u1ed7i c\u1ee7a t\u1eebng worker, v\xe0 t\u1ed5ng h\u1ee3p k\u1ebft qu\u1ea3.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"C\u1ea7n c\u01a1 ch\u1ebf \u0111\u1ec3 theo d\xf5i tr\u1ea1ng th\xe1i c\u1ee7a c\xe1c t\xe1c v\u1ee5 con.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Chi ph\xed giao ti\u1ebfp m\u1ea1ng gi\u1eefa dispatcher, worker, v\xe0 aggregator."))),(0,a.kt)("p",null,"Khi n\xe0o s\u1eed d\u1ee5ng: Khi c\u1ea7n x\u1eed l\xfd m\u1ed9t l\u01b0\u1ee3ng l\u1edbn d\u1eef li\u1ec7u ho\u1eb7c th\u1ef1c hi\u1ec7n m\u1ed9t t\xe1c v\u1ee5 ph\u1ee9c t\u1ea1p c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c chia th\xe0nh c\xe1c ph\u1ea7n \u0111\u1ed9c l\u1eadp ch\u1ea1y song song \u0111\u1ec3 gi\u1ea3m th\u1eddi gian ho\xe0n th\xe0nh t\u1ed5ng th\u1ec3. Th\u01b0\u1eddng th\u1ea5y trong x\u1eed l\xfd batch, data processing pipelines, ho\u1eb7c c\xe1c h\u1ec7 th\u1ed1ng t\xednh to\xe1n hi\u1ec7u n\u0103ng cao."),(0,a.kt)("h2",{id:"shared-database-anti-pattern-c\u1ea1m-b\u1eaby-c\u1ea7n-tr\xe1nh"},"Shared Database Anti-Pattern: C\u1ea1m b\u1eaby C\u1ea7n Tr\xe1nh"),(0,a.kt)("p",null,"\u0110\xe2y l\xe0 m\u1ed9t anti-pattern (m\u1ed9t gi\u1ea3i ph\xe1p ph\u1ed5 bi\u1ebfn nh\u01b0ng kh\xf4ng hi\u1ec7u qu\u1ea3 v\xe0 n\xean tr\xe1nh) trong ki\u1ebfn tr\xfac microservices, n\u01a1i nhi\u1ec1u service kh\xe1c nhau c\xf9ng truy c\u1eadp v\xe0 thao t\xe1c tr\xean c\xf9ng m\u1ed9t schema database."),(0,a.kt)("p",null,"T\u1ea1i sao l\xe0 Anti-pattern:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Coupling (Ph\u1ee5 thu\u1ed9c ch\u1eb7t ch\u1ebd): B\u1ea5t k\u1ef3 thay \u0111\u1ed5i n\xe0o trong schema database (th\xeam/s\u1eeda/x\xf3a b\u1ea3ng, c\u1ed9t) b\u1edfi m\u1ed9t team c\xf3 th\u1ec3 \u1ea3nh h\u01b0\u1edfng ho\u1eb7c l\xe0m h\u1ecfng c\xe1c service kh\xe1c \u0111ang d\xf9ng chung database \u0111\xf3. \u0110i\u1ec1u n\xe0y \u0111i ng\u01b0\u1ee3c l\u1ea1i nguy\xean t\u1eafc \u0111\u1ed9c l\u1eadp v\xe0 t\u1ef1 ch\u1ee7 c\u1ee7a microservices.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Kh\xf3 kh\u0103n trong vi\u1ec7c ph\xe1t tri\u1ec3n v\xe0 tri\u1ec3n khai \u0111\u1ed9c l\u1eadp: C\xe1c team kh\xf4ng th\u1ec3 t\u1ef1 do thay \u0111\u1ed5i c\u1ea5u tr\xfac d\u1eef li\u1ec7u c\u1ee7a m\xecnh m\xe0 kh\xf4ng c\u1ea7n ph\u1ed1i h\u1ee3p ch\u1eb7t ch\u1ebd v\xe0 ki\u1ec3m th\u1eed h\u1ed3i quy (regression testing) tr\xean t\u1ea5t c\u1ea3 c\xe1c service li\xean quan.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Kh\xf3 kh\u0103n trong vi\u1ec7c scale: Vi\u1ec7c scale database tr\u1edf n\xean ph\u1ee9c t\u1ea1p v\xec ph\u1ea3i \u0111\xe1p \u1ee9ng nhu c\u1ea7u c\u1ee7a nhi\u1ec1u service kh\xe1c nhau v\u1edbi c\xe1c pattern truy c\u1eadp d\u1eef li\u1ec7u kh\xe1c nhau. Kh\xf3 t\u1ed1i \u01b0u h\xf3a database cho m\u1ed9t service c\u1ee5 th\u1ec3.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"R\xe0o c\u1ea3n c\xf4ng ngh\u1ec7: T\u1ea5t c\u1ea3 c\xe1c service bu\u1ed9c ph\u1ea3i s\u1eed d\u1ee5ng chung m\u1ed9t c\xf4ng ngh\u1ec7 database, h\u1ea1n ch\u1ebf kh\u1ea3 n\u0103ng l\u1ef1a ch\u1ecdn c\xf4ng ngh\u1ec7 ph\xf9 h\u1ee3p nh\u1ea5t cho t\u1eebng service."))),(0,a.kt)("p",null,"Gi\u1ea3i ph\xe1p thay th\u1ebf: M\u1ed7i microservice n\xean s\u1edf h\u1eefu d\u1eef li\u1ec7u v\xe0 database ri\xeang c\u1ee7a m\xecnh (Database per Service pattern). Vi\u1ec7c giao ti\u1ebfp v\xe0 chia s\u1ebb d\u1eef li\u1ec7u gi\u1eefa c\xe1c service n\xean \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n th\xf4ng qua c\xe1c API \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a r\xf5 r\xe0ng ho\u1eb7c qua c\u01a1 ch\u1ebf event/messaging (k\u1ebft h\u1ee3p v\u1edbi c\xe1c pattern nh\u01b0 SAGA, Outbox/Inbox n\u1ebfu c\u1ea7n \u0111\u1ea3m b\u1ea3o consistency)."),(0,a.kt)("p",null,"Khi n\xe0o c\u1ea7n \u0111\u1eb7c bi\u1ec7t l\u01b0u \xfd: Khi chuy\u1ec3n \u0111\u1ed5i t\u1eeb ki\u1ebfn tr\xfac monolith sang microservices, vi\u1ec7c t\xe1ch database l\xe0 m\u1ed9t trong nh\u1eefng th\xe1ch th\u1ee9c l\u1edbn nh\u1ea5t v\xe0 c\u1ea7n \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n c\u1ea9n th\u1eadn \u0111\u1ec3 tr\xe1nh r\u01a1i v\xe0o anti-pattern n\xe0y."))}u.isMDXComponent=!0}}]);