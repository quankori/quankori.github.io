"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7188],{3905:(t,e,n)=>{n.d(e,{Zo:()=>u,kt:()=>d});var r=n(7294);function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e){if(null==t)return{};var n,r,a=function(t,e){if(null==t)return{};var n,r,a={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(a[n]=t[n]);return a}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}var p=r.createContext({}),i=function(t){var e=r.useContext(p),n=e;return t&&(n="function"==typeof t?t(e):c(c({},e),t)),n},u=function(t){var e=i(t.components);return r.createElement(p.Provider,{value:e},t.children)},l="mdxType",m={inlineCode:"code",wrapper:function(t){var e=t.children;return r.createElement(r.Fragment,{},e)}},g=r.forwardRef((function(t,e){var n=t.components,a=t.mdxType,o=t.originalType,p=t.parentName,u=s(t,["components","mdxType","originalType","parentName"]),l=i(n),g=a,d=l["".concat(p,".").concat(g)]||l[g]||m[g]||o;return n?r.createElement(d,c(c({ref:e},u),{},{components:n})):r.createElement(d,c({ref:e},u))}));function d(t,e){var n=arguments,a=e&&e.mdxType;if("string"==typeof t||a){var o=n.length,c=new Array(o);c[0]=g;var s={};for(var p in e)hasOwnProperty.call(e,p)&&(s[p]=e[p]);s.originalType=t,s[l]="string"==typeof t?t:a,c[1]=s;for(var i=2;i<o;i++)c[i]=n[i];return r.createElement.apply(null,c)}return r.createElement.apply(null,n)}g.displayName="MDXCreateElement"},4316:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>p,contentTitle:()=>c,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>i});var r=n(7462),a=(n(7294),n(3905));const o={title:"Authentication"},c=void 0,s={unversionedId:"programming/nestjs/authentication",id:"programming/nestjs/authentication",title:"Authentication",description:"Concept",source:"@site/docs/programming/nestjs/authentication.md",sourceDirName:"programming/nestjs",slug:"/programming/nestjs/authentication",permalink:"/docs/programming/nestjs/authentication",draft:!1,tags:[],version:"current",frontMatter:{title:"Authentication"},sidebar:"programming",previous:{title:"Providers",permalink:"/docs/programming/nestjs/providers"},next:{title:"Testing",permalink:"/docs/programming/nestjs/testing"}},p={},i=[{value:"Concept",id:"concept",level:2},{value:"Explain code",id:"explain-code",level:2}],u={toc:i},l="wrapper";function m(t){let{components:e,...n}=t;return(0,a.kt)(l,(0,r.Z)({},u,n,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"concept"},"Concept"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Passport Strategy")),(0,a.kt)("p",null,"Passport l\xe0 m\u1ed9t th\u01b0 vi\u1ec7n x\xe1c th\u1ef1c m\u1ea1nh m\u1ebd cho Node.js, cho ph\xe9p b\u1ea1n x\xe1c th\u1ef1c ng\u01b0\u1eddi d\xf9ng th\xf4ng qua nhi\u1ec1u ph\u01b0\u01a1ng th\u1ee9c nh\u01b0 JWT, OAuth, Local, etc. Passport Strategy l\xe0 m\u1ed9t ph\u1ea7n c\u1ee7a Passport ch\u1ecbu tr\xe1ch nhi\u1ec7m x\xe1c th\u1ef1c ng\u01b0\u1eddi d\xf9ng d\u1ef1a tr\xean m\u1ed9t c\xe1ch c\u1ee5 th\u1ec3 (v\xed d\u1ee5: JWTStrategy \u0111\u1ec3 x\xe1c th\u1ef1c JWT)."),(0,a.kt)("p",null,"Khi m\u1ed9t request \u0111\u1ebfn, JWTStrategy (m\u1ed9t Passport Strategy) s\u1ebd \u0111\u01b0\u1ee3c k\xedch ho\u1ea1t b\u1edfi JwtAuthGuard (m\u1ed9t Guard) \u0111\u1ec3 ki\u1ec3m tra xem token trong request c\xf3 h\u1ee3p l\u1ec7 kh\xf4ng. N\u1ebfu token h\u1ee3p l\u1ec7, validate method trong JWTStrategy s\u1ebd \u0111\u01b0\u1ee3c g\u1ecdi \u0111\u1ec3 x\xe1c th\u1ef1c ng\u01b0\u1eddi d\xf9ng v\xe0 tr\u1ea3 v\u1ec1 th\xf4ng tin ng\u01b0\u1eddi d\xf9ng (v\xed d\u1ee5: userId, username). Sau \u0111\xf3, th\xf4ng tin n\xe0y c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng trong route handler."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Guards")),(0,a.kt)("p",null,"Guards trong NestJS l\xe0 c\xe1c interceptor \u0111\u1ec3 b\u1ea3o v\u1ec7 c\xe1c endpoint kh\u1ecfi vi\u1ec7c truy c\u1eadp tr\xe1i ph\xe9p. M\u1ed7i request s\u1ebd \u0111\u01b0\u1ee3c ki\u1ec3m tra b\u1edfi guards tr\u01b0\u1edbc khi n\xf3 \u0111\u1ebfn t\u1edbi route handler. Guards ki\u1ec3m tra xem ng\u01b0\u1eddi d\xf9ng c\xf3 quy\u1ec1n truy c\u1eadp hay kh\xf4ng b\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng x\xe1c th\u1ef1c (authentication) ho\u1eb7c c\xe1c logic t\xf9y ch\u1ec9nh kh\xe1c."),(0,a.kt)("h2",{id:"explain-code"},"Explain code"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Sign & verify token")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"jwt.sign(payload, secretKey, options);\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"jwt.verify(payload, secretKey);\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Strategy")),(0,a.kt)("p",null,"T\u1ea1o m\u1ed9t Passport Strategy (v\xed d\u1ee5: JWTStrategy) \u0111\u1ec3 x\xe1c th\u1ef1c user d\u1ef1a tr\xean JWT"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"// jwt.strategy.ts\nimport { Injectable } from '@nestjs/common';\nimport { PassportStrategy } from '@nestjs/passport';\nimport { Strategy, ExtractJwt } from 'passport-jwt';\nimport { AuthService } from './auth.service';\n\n@Injectable()\nexport class JwtStrategy extends PassportStrategy(Strategy) {\n  constructor(private authService: AuthService) {\n    super({\n      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n      secretOrKey: 'your-secret-key',\n    });\n  }\n\n  async validate(payload: any) {\n    return { userId: payload.sub, username: payload.username };\n  }\n}\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Guards")),(0,a.kt)("p",null,"T\u1ea1o m\u1ed9t Guard \u0111\u1ec3 s\u1eed d\u1ee5ng Strategy \u0111\xe3 t\u1ea1o v\xe0 ki\u1ec3m tra xem n\xf3 c\xf3 h\u1ee3p l\u1ec7 kh\xf4ng. N\u1ebfu h\u1ee3p l\u1ec7 th\xec g\u1eedi qua cho JwtStrategy"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"// jwt-auth.guard.ts\nimport { Injectable } from '@nestjs/common';\nimport { AuthGuard } from '@nestjs/passport';\n\n@Injectable()\nexport class JwtAuthGuard extends AuthGuard('jwt') {}\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Router")),(0,a.kt)("p",null,"Khai b\xe1o guard trong router "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"// app.controller.ts\nimport { Controller, Get, UseGuards } from '@nestjs/common';\nimport { JwtAuthGuard } from './jwt-auth.guard';\n\n@Controller('protected')\nexport class AppController {\n  @Get()\n  @UseGuards(JwtAuthGuard)\n  getProtectedData() {\n    return { message: 'This is protected data.' };\n  }\n}\n")))}m.isMDXComponent=!0}}]);